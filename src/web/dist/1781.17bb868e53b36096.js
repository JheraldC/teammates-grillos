(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[1781],{57286:(N,T,n)=>{"use strict";n.d(T,{y:()=>c});var d=n(17705);let c=(()=>{class E{constructor(){this.useBlueSpinner=!1,this.color="white"}static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275cmp=d.VBU({type:E,selectors:[["tm-ajax-loading"]],inputs:{useBlueSpinner:"useBlueSpinner",color:"color"},decls:2,vars:3,consts:[[1,"loading-container"],["role","status"]],template:function(p,b){1&p&&(d.j41(0,"div",0),d.nrm(1,"div",1),d.k0s()),2&p&&(d.R7$(1),d.ZvI("spinner-border spinner-border-sm text-",b.useBlueSpinner?"primary":b.color,""))},styles:[".loading-container[_ngcontent-%COMP%]{display:inline;margin-right:10px}"]})}return E})()},86082:(N,T,n)=>{"use strict";n.d(T,{F:()=>M});var d=n(17705),c=n(60177);function E(p,b){if(1&p&&d.nrm(0,"i",3),2&p){const _=d.XpG();d.xc7("color",_.chevronColor)}}function g(p,b){if(1&p&&d.nrm(0,"i",4),2&p){const _=d.XpG();d.xc7("color",_.chevronColor)}}let M=(()=>{class p{constructor(){this.isExpanded=!1,this.chevronColor="white"}static#e=this.\u0275fac=function(F){return new(F||p)};static#t=this.\u0275cmp=d.VBU({type:p,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded",chevronColor:"chevronColor"},decls:3,vars:3,consts:[["type","button","aria-label","Expand panel",1,"chevron","btn-course","btn","btn-primary","btn-sm"],["class","fas fa-chevron-down",3,"color",4,"ngIf"],["class","fas fa-chevron-up",3,"color",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(F,u){1&F&&(d.j41(0,"button",0),d.DNE(1,E,1,2,"i",1),d.DNE(2,g,1,2,"i",2),d.k0s()),2&F&&(d.BMQ("aria-expanded",u.isExpanded),d.R7$(1),d.Y8G("ngIf",!u.isExpanded),d.R7$(1),d.Y8G("ngIf",u.isExpanded))},dependencies:[c.bT],styles:["button.chevron[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;background-color:inherit;border-width:0}button.chevron[_ngcontent-%COMP%]:active{background-color:inherit}"]})}return p})()},57125:(N,T,n)=>{"use strict";n.d(T,{o:()=>E});var d=n(60177),c=n(17705);let E=(()=>{class g{static#e=this.\u0275fac=function(b){return new(b||g)};static#t=this.\u0275mod=c.$C({type:g});static#s=this.\u0275inj=c.G2t({imports:[d.MD]})}return g})()},64943:(N,T,n)=>{"use strict";n.d(T,{y:()=>c});var d=n(17705);let c=(()=>{class E{transform(M){return Object.keys(M).map(p=>M[p])}static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275pipe=d.EJ8({name:"enumToArray",type:E,pure:!0})}return E})()},19379:(N,T,n)=>{"use strict";n.d(T,{B:()=>E});var d=n(40035),c=n(17705);let E=(()=>{class g{transform(p){switch(p){case d.tp.STUDENTS:return"students";case d.tp.STUDENTS_EXCLUDING_SELF:return"students (excluding self)";case d.tp.TEAMS:return"teams";case d.tp.TEAMS_EXCLUDING_SELF:return"teams (excluding own team)";case d.tp.OWN_TEAM_MEMBERS_INCLUDING_SELF:return"team members";case d.tp.OWN_TEAM_MEMBERS:return"team members (excluding self)";case d.tp.INSTRUCTORS:return"instructors";default:return"unknown"}}static#e=this.\u0275fac=function(b){return new(b||g)};static#t=this.\u0275pipe=c.EJ8({name:"generatedChoice",type:g,pure:!0})}return g})()},15069:(N,T,n)=>{"use strict";n.d(T,{m:()=>d});var d=function(c){return c.ESSAY="essay-questions",c.SINGLE_ANSWER_MCQ="single-answer-mcq",c.MULTIPLE_ANSWER_MCQ="multiple-answer-mcq",c.NUMERICAL_SCALE="numerical-scale",c.POINTS_OPTIONS="points-options",c.POINTS_RECIPIENTS="points-recipients",c.CONTRIBUTION="contribution",c.RUBRIC="rubric",c.RANK_OPTIONS="rank-options",c.RANK_RECIPIENTS="rank-recipients",c}(d||{})},25552:(N,T,n)=>{"use strict";n.d(T,{Z:()=>d});var d=function(c){return c.students="students",c.courses="courses",c.sessions="sessions",c.questions="questions",c.general="general",c.body="body",c}(d||{})},36430:(N,T,n)=>{"use strict";n.r(T),n.d(T,{InstructorSessionEditPageModule:()=>Ye});var d=n(60177),c=n(89417),E=n(82646),g=n(94227),M=n(27468),p=n(7673),b=n(71985),_=n(70980),F=n(70274),u=n(94089),l=n(26195),e=n(17705),h=n(30715),v=n(26412),x=n(16),O=n(57645),Q=n(72890),q=n(86082),R=n(68705);function I(r,f){1&r&&e.nrm(0,"i",37)}function L(r,f){1&r&&e.nrm(0,"i",38)}function V(r,f){1&r&&e.nrm(0,"i",37)}function U(r,f){1&r&&e.nrm(0,"i",38)}function X(r,f){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",39),e.bIt("ngModelChange",function(i){const a=e.eBV(t).$implicit;return e.Njj(a.isSelected=i)}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.nI1(5,"questionTypeName"),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s()()}if(2&r){const t=f.$implicit;e.R7$(2),e.Y8G("ngModel",t.isSelected),e.R7$(2),e.JRh(e.bMT(5,3,t.question.questionType)),e.R7$(3),e.JRh(t.question.questionBrief)}}function $(r,f){if(1&r){const t=e.RV6();e.qex(0),e.j41(1,"table",29)(2,"thead",30)(3,"tr")(4,"th"),e.EFF(5,"#"),e.k0s(),e.j41(6,"th",31),e.bIt("click",function(){e.eBV(t);const i=e.XpG(4).$implicit,o=e.XpG();return e.Njj(o.sortQuestionsToCopyForFeedbackSession(i,o.SortBy.QUESTION_TYPE))}),e.j41(7,"button"),e.EFF(8," Question Type "),e.j41(9,"span",32),e.nrm(10,"i",33),e.DNE(11,I,1,0,"i",34),e.DNE(12,L,1,0,"i",35),e.k0s()()(),e.j41(13,"th",31),e.bIt("click",function(){e.eBV(t);const i=e.XpG(4).$implicit,o=e.XpG();return e.Njj(o.sortQuestionsToCopyForFeedbackSession(i,o.SortBy.QUESTION_TEXT))}),e.j41(14,"button"),e.EFF(15," Question Text "),e.j41(16,"span",32),e.nrm(17,"i",33),e.DNE(18,V,1,0,"i",34),e.DNE(19,U,1,0,"i",35),e.k0s()()()()(),e.j41(20,"tbody"),e.DNE(21,X,8,5,"tr",36),e.k0s()(),e.bVm()}if(2&r){const t=e.XpG(4).$implicit,s=e.XpG();e.R7$(6),e.BMQ("aria-sort",s.getAriaSort(t,s.SortBy.QUESTION_TYPE)),e.R7$(5),e.Y8G("ngIf",s.isSortQuestionsBy(t,s.SortBy.QUESTION_TYPE,s.SortOrder.DESC)),e.R7$(1),e.Y8G("ngIf",s.isSortQuestionsBy(t,s.SortBy.QUESTION_TYPE,s.SortOrder.ASC)),e.R7$(1),e.BMQ("aria-sort",s.getAriaSort(t,s.SortBy.QUESTION_TEXT)),e.R7$(5),e.Y8G("ngIf",s.isSortQuestionsBy(t,s.SortBy.QUESTION_TEXT,s.SortOrder.DESC)),e.R7$(1),e.Y8G("ngIf",s.isSortQuestionsBy(t,s.SortBy.QUESTION_TEXT,s.SortOrder.ASC)),e.R7$(2),e.Y8G("ngForOf",t.questionsTableRowModels)}}function Y(r,f){if(1&r){const t=e.RV6();e.j41(0,"div",25),e.DNE(1,$,22,7,"ng-container",26),e.j41(2,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(3).$implicit,o=e.XpG();return e.Njj(o.loadQuestions(i))}),e.nrm(3,"i",28),e.EFF(4," \xa0Reload "),e.k0s()()}if(2&r){const t=e.XpG(3).$implicit,s=e.sdS(9);e.R7$(1),e.Y8G("ngIf",t.hasQuestionsLoaded&&t.questionsTableRowModels.length>0)("ngIfElse",s)}}function H(r,f){if(1&r&&(e.j41(0,"div"),e.DNE(1,Y,5,2,"div",24),e.k0s()),2&r){const t=e.XpG(2).$implicit;e.R7$(1),e.Y8G("ngIf",!t.hasLoadingFailed)}}function W(r,f){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"tm-loading-retry",22),e.bIt("retryEvent",function(){e.eBV(t);const i=e.XpG().$implicit,o=e.XpG();return e.Njj(o.loadQuestions(i))}),e.DNE(2,H,2,1,"div",23),e.k0s()()}if(2&r){const t=e.XpG().$implicit;e.R7$(1),e.Y8G("shouldShowRetry",t.hasLoadingFailed)("message","Failed to load questions"),e.R7$(1),e.Y8G("tmIsLoading",!t.hasQuestionsLoaded)}}function Z(r,f){1&r&&(e.j41(0,"h5"),e.EFF(1,"There are no questions in this feedback session available for copying."),e.k0s())}function J(r,f){if(1&r){const t=e.RV6();e.j41(0,"div",14)(1,"div",15)(2,"div",16),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.toggleCard(o))}),e.j41(3,"strong",17),e.EFF(4),e.k0s(),e.j41(5,"div",18),e.nrm(6,"tm-panel-chevron",19),e.k0s()(),e.DNE(7,W,3,3,"div",20),e.DNE(8,Z,2,0,"ng-template",null,21,e.C5r),e.k0s()()}if(2&r){const t=f.$implicit;e.R7$(4),e.Lme("[",t.courseId,"] Session: ",t.feedbackSessionName,""),e.R7$(2),e.Y8G("isExpanded",t.isTabExpanded),e.R7$(1),e.Y8G("ngIf",t.isTabExpanded)}}let K=(()=>{class r{constructor(t,s,i,o){this.activeModal=t,this.statusMessageService=s,this.feedbackQuestionsService=i,this.tableComparatorService=o,this.SortBy=l.g,this.SortOrder=l.x,this.feedbackSessionTabModels=[],this.feedbackSessionTabModelsSortBy=l.g.COURSE_ID}toggleCard(t){t.isTabExpanded=!t.isTabExpanded,t.hasQuestionsLoaded||this.loadQuestions(t)}loadQuestions(t){t.hasQuestionsLoaded=!1,t.hasLoadingFailed=!1,t.questionsTableRowModels=[],this.feedbackQuestionsService.getFeedbackQuestions({courseId:t.courseId,feedbackSessionName:t.feedbackSessionName,intent:u.JD.FULL_DETAIL}).subscribe({next:s=>{s.questions.forEach(i=>{t.questionsTableRowModels.push({question:i,isSelected:!1})}),t.hasQuestionsLoaded=!0},error:s=>{t.hasLoadingFailed=!0,this.statusMessageService.showErrorToast(s.error.message)}})}getSelectedQuestions(){const t=[];return this.feedbackSessionTabModels.forEach(s=>{s.questionsTableRowModels.length>0&&t.push(...s.questionsTableRowModels.filter(i=>i.isSelected).map(i=>i.question))}),t}isSelectedForSorting(t){return this.feedbackSessionTabModelsSortBy===t}isSortQuestionsBy(t,s,i){return t.questionsTableRowModelsSortBy===s&&t.questionsTableRowModelsSortOrder===i}getAriaSort(t,s){return t.questionsTableRowModelsSortBy!==s?"none":t.questionsTableRowModelsSortOrder===l.x.ASC?"ascending":"descending"}sortFeedbackSessionTabs(t){this.feedbackSessionTabModelsSortBy=t,this.feedbackSessionTabModels.sort(this.sortFeedbackSessionsBy(t))}sortQuestionsToCopyForFeedbackSession(t,s){t.questionsTableRowModelsSortBy=s,t.questionsTableRowModelsSortOrder=t.questionsTableRowModelsSortOrder===l.x.DESC?l.x.ASC:l.x.DESC,t.questionsTableRowModels.sort(this.sortQuestionsBy(s,t.questionsTableRowModelsSortOrder))}sortFeedbackSessionsBy(t){return(s,i)=>{let o,a,m;switch(t){case l.g.COURSE_ID:o=s.courseId.toString(),a=i.courseId.toString(),m=l.x.ASC;break;case l.g.SESSION_NAME:o=s.feedbackSessionName,a=i.feedbackSessionName,m=l.x.ASC;break;case l.g.SESSION_CREATION_DATE:o=s.createdAtTimestamp.toString(),a=i.createdAtTimestamp.toString(),m=l.x.DESC;break;default:o="",a="",m=l.x.ASC}return this.tableComparatorService.compare(t,m,o,a)}}sortQuestionsBy(t,s){return(i,o)=>{let a,m;switch(t){case l.g.QUESTION_TYPE:a=i.question.questionType,m=o.question.questionType;break;case l.g.QUESTION_TEXT:a=i.question.questionBrief,m=o.question.questionBrief;break;default:a="",m=""}return this.tableComparatorService.compare(t,s,a,m)}}get hasAnyQuestionsToCopySelected(){return this.feedbackSessionTabModels.reduce((t,s)=>t||!!s.questionsTableRowModels.find(i=>i.isSelected),!1)}static#e=this.\u0275fac=function(s){return new(s||r)(e.rXU(g.Lw),e.rXU(h.x),e.rXU(v.q),e.rXU(x.C))};static#t=this.\u0275cmp=e.VBU({type:r,selectors:[["tm-copy-questions-from-other-sessions-modal"]],decls:21,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["id","copy-question-modal",1,"modal-body"],[1,"col-12","mb-3","text-md-end"],[1,"d-inline"],["data-toggle","buttons",1,"btn-group"],["id","sort-course-id",1,"btn","btn-light",3,"disabled","click"],["id","sort-session-name",1,"btn","btn-light",3,"disabled","click"],["id","sort-creation-date",1,"btn","btn-light",3,"disabled","click"],["class","feedback-session-tabs",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy-question","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"feedback-session-tabs"],[1,"card"],[1,"card-header","cursor-pointer","bg-primary","text-white",3,"click"],[1,"text-break"],[1,"card-header-btn-toolbar"],[3,"isExpanded"],[4,"ngIf"],["noQuestionsTemplate",""],[3,"shouldShowRetry","message","retryEvent"],[4,"tmIsLoading"],["class","card-body",4,"ngIf"],[1,"card-body"],[4,"ngIf","ngIfElse"],[1,"btn","btn-primary","float-end","mt-2","mb-3",3,"click"],["aria-hidden","true",1,"fas","fa-redo"],["id","copy-question-table",1,"table","table-bordered","table-responsive-lg"],[1,"bg-primary","text-white"],[1,"sortable-header",3,"click"],["aria-hidden","true",1,"fa-stack"],[1,"fas","fa-sort"],["class","fas fa-sort-down",4,"ngIf"],["class","fas fa-sort-up",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fas","fa-sort-down"],[1,"fas","fa-sort-up"],["type","checkbox",3,"ngModel","ngModelChange"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"h4",1),e.EFF(2,"Copy Questions"),e.k0s(),e.j41(3,"button",2),e.bIt("click",function(){return i.activeModal.dismiss()}),e.k0s()(),e.j41(4,"div",3)(5,"div",4)(6,"strong",5),e.EFF(7," Sort Sessions By: "),e.k0s(),e.j41(8,"div",6)(9,"button",7),e.bIt("click",function(){return i.sortFeedbackSessionTabs(i.SortBy.COURSE_ID)}),e.EFF(10,"Course ID"),e.k0s(),e.j41(11,"button",8),e.bIt("click",function(){return i.sortFeedbackSessionTabs(i.SortBy.SESSION_NAME)}),e.EFF(12,"Session Name"),e.k0s(),e.j41(13,"button",9),e.bIt("click",function(){return i.sortFeedbackSessionTabs(i.SortBy.SESSION_CREATION_DATE)}),e.EFF(14,"Creation Date"),e.k0s()()(),e.DNE(15,J,10,4,"div",10),e.k0s(),e.j41(16,"div",11)(17,"button",12),e.bIt("click",function(){return i.activeModal.close(i.getSelectedQuestions())}),e.EFF(18,"Copy"),e.k0s(),e.j41(19,"button",13),e.bIt("click",function(){return i.activeModal.dismiss()}),e.EFF(20,"Cancel"),e.k0s()()),2&s&&(e.R7$(9),e.Y8G("disabled",i.isSelectedForSorting(i.SortBy.COURSE_ID)),e.R7$(2),e.Y8G("disabled",i.isSelectedForSorting(i.SortBy.SESSION_NAME)),e.R7$(2),e.Y8G("disabled",i.isSelectedForSorting(i.SortBy.SESSION_CREATION_DATE)),e.R7$(2),e.Y8G("ngForOf",i.feedbackSessionTabModels),e.R7$(2),e.Y8G("disabled",!i.hasAnyQuestionsToCopySelected))},dependencies:[d.Sq,d.bT,c.Zm,c.BC,c.vS,O.n,Q.Y,q.F,R.c],styles:[".sortable-header[_ngcontent-%COMP%]{cursor:pointer}.sortable-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.3em}.sortable-header[_ngcontent-%COMP%]   .fa-stack[_ngcontent-%COMP%]{width:20%}.sortable-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;color:inherit;border:none;padding:0;text-align:left;width:100%;font:inherit;cursor:inherit}#copy-question-modal[_ngcontent-%COMP%]{table-layout:auto;margin-bottom:10px;min-width:70vw}.modal-footer[_ngcontent-%COMP%]{justify-content:right;background-color:#fff}"]})}return r})();var z=n(44199),j=n(59990);function ee(r,f){if(1&r&&(e.j41(0,"div")(1,"div",14),e.nrm(2,"tm-question-edit-form",15),e.k0s()()),2&r){const t=e.XpG().$implicit;e.Y8G("@collapseAnim",void 0),e.R7$(2),e.Y8G("formModel",t.model)}}function te(r,f){if(1&r){const t=e.RV6();e.j41(0,"div",8)(1,"div",9),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.isShowDetails=!o.isShowDetails)}),e.j41(2,"label",10)(3,"input",11),e.bIt("ngModelChange",function(i){const a=e.eBV(t).$implicit;return e.Njj(a.isSelected=i)})("click",function(i){return i.stopPropagation()}),e.k0s()(),e.EFF(4,"\xa0 "),e.nrm(5,"span",12),e.k0s(),e.DNE(6,ee,3,2,"div",13),e.k0s()}if(2&r){const t=f.$implicit;e.R7$(3),e.Y8G("ngModel",t.isSelected),e.R7$(2),e.Y8G("innerHTML",t.description,e.npT),e.R7$(1),e.Y8G("ngIf",t.isShowDetails)}}let se=(()=>{class r{constructor(t,s){this.activeModal=t,this.feedbackQuestionsService=s,this.templateQuestionModels=[],this.templateQuestionModels=this.feedbackQuestionsService.getTemplateQuestions().map(i=>({description:i.description,isShowDetails:!1,isSelected:!1,model:{feedbackQuestionId:"",questionNumber:i.question.questionNumber,questionBrief:i.question.questionBrief,questionDescription:i.question.questionDescription,isQuestionHasResponses:!1,questionType:i.question.questionType,questionDetails:i.question.questionDetails,giverType:i.question.giverType,recipientType:i.question.recipientType,numberOfEntitiesToGiveFeedbackToSetting:i.question.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:i.question.customNumberOfEntitiesToGiveFeedbackTo||1,showResponsesTo:i.question.showResponsesTo,showGiverNameTo:i.question.showGiverNameTo,showRecipientNameTo:i.question.showRecipientNameTo,isDeleting:!1,isDuplicating:!1,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}))}get hasAnyTemplateQuestionSelected(){return this.templateQuestionModels.some(t=>t.isSelected)}getSelectedQuestions(){return this.templateQuestionModels.filter(t=>t.isSelected).map(t=>t.model).map(t=>({feedbackQuestionId:"",questionNumber:0,questionBrief:t.questionBrief,questionDescription:t.questionDescription,questionType:t.questionType,questionDetails:t.questionDetails,giverType:t.giverType,recipientType:t.recipientType,numberOfEntitiesToGiveFeedbackToSetting:t.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:t.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:t.showResponsesTo,showGiverNameTo:t.showGiverNameTo,showRecipientNameTo:t.showRecipientNameTo}))}static#e=this.\u0275fac=function(s){return new(s||r)(e.rXU(g.Lw),e.rXU(v.q))};static#t=this.\u0275cmp=e.VBU({type:r,selectors:[["ng-component"]],decls:11,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["id","template-question-modal",1,"modal-body"],["class","card margin-top-20px",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-template","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card","margin-top-20px"],[1,"card-header","cursor-pointer",3,"click"],[1,"checkbox-label"],["type","checkbox",3,"ngModel","ngModelChange","click"],[1,"template-description",3,"innerHTML"],[4,"ngIf"],[1,"card-body"],["isDisplayOnly","true",3,"formModel"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"h4",1),e.EFF(2,"Add Template Questions"),e.k0s(),e.j41(3,"button",2),e.bIt("click",function(){return i.activeModal.dismiss()}),e.k0s()(),e.j41(4,"div",3),e.DNE(5,te,7,3,"div",4),e.k0s(),e.j41(6,"div",5)(7,"button",6),e.bIt("click",function(){return i.activeModal.close(i.getSelectedQuestions())}),e.EFF(8,"Add"),e.k0s(),e.j41(9,"button",7),e.bIt("click",function(){return i.activeModal.dismiss()}),e.EFF(10,"Close"),e.k0s()()),2&s&&(e.R7$(5),e.Y8G("ngForOf",i.templateQuestionModels),e.R7$(2),e.Y8G("disabled",!i.hasAnyTemplateQuestionSelected))},dependencies:[d.Sq,d.bT,c.Zm,c.BC,c.vS,j.E],styles:[".margin-top-20px[_ngcontent-%COMP%]{margin-top:20px}.template-description[_ngcontent-%COMP%]{cursor:pointer}.checkbox-label[_ngcontent-%COMP%]{margin:1px 3px 0 0;align-self:flex-start}"],data:{animation:[z.j]}})}return r})();var k=n(59919),C=n(40035),G=n(47650),A=n(40261),ie=n(10424),P=n(39778),oe=n(58857),ne=n(34891),re=n(21894),ae=n(29267),de=n(21036),le=n(73629),ce=n(43743),ue=n(6294),me=n(58240),pe=n(31571),he=n(50833),fe=n(90446),ge=n(86978),_e=n(89734),Ee=n(90205),be=n(36122),Te=n(66718),ve=n(92042);const Se=["modifiedTimestampsModal"];function Me(r,f){if(1&r){const t=e.RV6();e.j41(0,"tm-session-edit-form",7),e.bIt("modelChange",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.sessionEditFormModel=i)})("editExistingSessionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.editExistingSessionHandler())})("modelChange",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.triggerModelChange(i))})("cancelEditingSessionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelEditingSessionHandler())})("deleteExistingSessionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteExistingSessionHandler())})("copyCurrentSessionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.copyCurrentSession())}),e.k0s()}if(2&r){const t=e.XpG();e.Y8G("formMode",t.SessionEditFormMode.EDIT)("model",t.sessionEditFormModel)}}function Fe(r,f){if(1&r){const t=e.RV6();e.j41(0,"div",8)(1,"button",9),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.isAllCollapsed?i.expandAll():i.collapseAll())}),e.EFF(2),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(2),e.SpI(" ",t.isAllCollapsed?"Expand":"Collapse"," All ")}}function Ce(r,f){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"tm-question-edit-form",13),e.bIt("saveExistingQuestionEvent",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.saveExistingQuestionHandler(o))})("discardExistingQuestionChangesEvent",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.discardExistingQuestionHandler(o))})("duplicateCurrentQuestionEvent",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.duplicateCurrentQuestionHandler(o))})("deleteCurrentQuestionEvent",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.deleteExistingQuestionHandler(o))})("formModelChange",function(i){const a=e.eBV(t).index,m=e.XpG(2);return e.Njj(m.questionEditFormModels[a]=i)}),e.k0s()()}if(2&r){const t=f.index,s=e.XpG(2);e.R7$(1),e.Y8G("formMode",s.QuestionEditFormMode.EDIT)("numOfQuestions",s.questionEditFormModels.length)("formModel",s.questionEditFormModels[t])("isQuestionPublished",s.sessionEditFormModel.publishStatus===s.FeedbackSessionPublishStatus.PUBLISHED)}}function ye(r,f){if(1&r){const t=e.RV6();e.j41(0,"div"),e.DNE(1,Ce,2,4,"div",10),e.j41(2,"a",11),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.scrollToTopOfPage())}),e.EFF(3," Back to Top "),e.nrm(4,"i",12),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.questionEditFormModels)("ngForTrackBy",t.trackQuestionEditFormByFn)}}function Ne(r,f){1&r&&e.nrm(0,"div")}function Ie(r,f){if(1&r){const t=e.RV6();e.j41(0,"div",14)(1,"tm-adding-question-panel",15),e.bIt("templateQuestionModalEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.templateQuestionModalHandler())})("populateAndShowNewQuestionFormEvent",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.populateAndShowNewQuestionForm(i))})("copyQuestionsFromOtherSessionsEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.copyQuestionsFromOtherSessionsHandler())}),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(1),e.Y8G("isCopyingQuestion",t.isCopyingQuestion)}}function Qe(r,f){if(1&r){const t=e.RV6();e.j41(0,"tm-question-edit-form",16),e.bIt("discardNewQuestionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.isAddingQuestionPanelExpanded=!1)})("createNewQuestionEvent",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.createNewQuestionHandler())})("formModelChange",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.newQuestionEditFormModel=i)}),e.k0s()}if(2&r){const t=e.XpG();e.Y8G("formMode",t.QuestionEditFormMode.ADD)("numOfQuestions",t.questionEditFormModels.length+1)("formModel",t.newQuestionEditFormModel)}}function ke(r,f){if(1&r&&(e.j41(0,"div",14),e.nrm(1,"tm-preview-session-panel",17),e.k0s()),2&r){const t=e.XpG();e.R7$(1),e.Y8G("courseId",t.courseId)("feedbackSessionName",t.feedbackSessionName)("emailOfStudentToPreview",t.emailOfStudentToPreview)("studentsOfCourse",t.studentsOfCourse)("instructorsCanBePreviewedAs",t.instructorsOfCourse)("emailOfInstructorToPreview",t.emailOfInstructorToPreview)}}function Oe(r,f){if(1&r&&e.nrm(0,"tm-modified-timestamps-modal",18),2&r){const t=e.XpG();e.Y8G("coursesOfModifiedSession",t.coursesOfModifiedSession)("modifiedSessions",t.modifiedSession)}}let Re=(()=>{class r extends ae.v{get isAllCollapsed(){return this.questionEditFormModels.some(t=>t.isCollapsed)}constructor(t,s,i,o,a,m,S,y,D,B,w,He,We,Ze,Je,Ke){super(t,s,i,o,a,m,S,y,D,B,w),this.datetimeService=He,this.studentService=We,this.courseService=Ze,this.route=Je,this.changeDetectorRef=Ke,this.SessionEditFormMode=ne.o,this.QuestionEditFormMode=oe._,this.FeedbackQuestionType=C.OX,this.FeedbackSessionPublishStatus=C.DG,this.courseId="",this.feedbackSessionName="",this.isEditingMode=!1,this.courseName="",this.studentDeadlines={},this.instructorDeadlines={},this.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(this.sessionEditFormModel)),this.feedbackQuestionModels=new Map,this.questionEditFormModels=[],this.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:0,questionBrief:"",questionDescription:"",isQuestionHasResponses:!1,questionType:C.OX.TEXT,questionDetails:{questionType:C.OX.TEXT,questionText:""},giverType:C.tp.STUDENTS,recipientType:C.tp.STUDENTS_EXCLUDING_SELF,numberOfEntitiesToGiveFeedbackToSetting:C.cB.UNLIMITED,customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:[],showGiverNameTo:[],showRecipientNameTo:[],isDeleting:!1,isDuplicating:!1,isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},this.isAddingFromTemplate=!1,this.isAddingQuestionPanelExpanded=!1,this.isLoadingFeedbackSession=!1,this.hasLoadingFeedbackSessionFailed=!1,this.isLoadingFeedbackQuestions=!1,this.hasLoadingFeedbackQuestionsFailed=!1,this.isCopyingQuestion=!1,this.studentsOfCourse=[],this.emailOfStudentToPreview="",this.instructorsOfCourse=[],this.emailOfInstructorToPreview=""}ngOnInit(){this.route.queryParams.subscribe(t=>{this.courseId=t.courseid,this.feedbackSessionName=t.fsname,this.isEditingMode="true"===t.editingMode,this.loadFeedbackSession(),this.loadFeedbackQuestions(),this.getAllStudentsOfCourse(),this.getAllInstructors()})}loadFeedbackSession(){this.hasLoadingFeedbackSessionFailed=!1,this.isLoadingFeedbackSession=!0,this.courseService.getCourseAsInstructor(this.courseId).subscribe({next:t=>{this.courseName=t.courseName,this.feedbackSessionsService.getFeedbackSession({courseId:this.courseId,feedbackSessionName:this.feedbackSessionName,intent:u.JD.FULL_DETAIL}).pipe((0,_.j)(()=>{this.isLoadingFeedbackSession=!1})).subscribe({next:s=>{this.sessionEditFormModel=this.getSessionEditFormModel(s,this.isEditingMode),this.feedbackSessionModelBeforeEditing=this.getSessionEditFormModel(s)},error:s=>{this.hasLoadingFeedbackSessionFailed=!0,this.statusMessageService.showErrorToast(s.error.message)}})},error:t=>{this.statusMessageService.showErrorToast(t.error.message),this.isLoadingFeedbackSession=!1,this.hasLoadingFeedbackSessionFailed=!0}})}copyCurrentSession(){return new Promise((t,s)=>{this.courseService.getInstructorCoursesThatAreActive().pipe((0,_.j)(()=>{this.sessionEditFormModel.isCopying=!1})).subscribe(i=>{this.failedToCopySessions={},this.coursesOfModifiedSession=[],this.modifiedSession={};const o=this.ngbModal.open(ie.o);o.componentInstance.newFeedbackSessionName=this.feedbackSessionName,o.componentInstance.courseCandidates=i.courses,o.componentInstance.sessionToCopyCourseId=this.courseId,o.result.then(a=>{const m=this.createSessionCopyRequestsFromModal(a,this.courseId,this.feedbackSessionName);this.sessionEditFormModel.isCopying=!0,1===m.length&&this.copySingleSession(m[0].pipe((0,_.j)(()=>{this.sessionEditFormModel.isCopying=!1})),this.modifiedTimestampsModal),m.length>1&&(0,M.p)(m).pipe((0,_.j)(()=>{this.sessionEditFormModel.isCopying=!1})).subscribe(()=>{this.showCopyStatusMessage(this.modifiedTimestampsModal)})},a=>{s(a),this.statusMessageService.showErrorToast(a.error.message)}).catch(()=>{this.sessionEditFormModel.isCopying=!1})})})}getSessionEditFormModel(t,s=!1){const i=this.datetimeService.getDateTimeAtTimezone(t.submissionStartTimestamp,t.timeZone,!0),o=this.datetimeService.getDateTimeAtTimezone(t.submissionEndTimestamp,t.timeZone,!0),a={isEditable:s,courseId:t.courseId,timeZone:t.timeZone,courseName:this.courseName,feedbackSessionName:t.feedbackSessionName,instructions:t.instructions,submissionStartTime:i.time,submissionStartDate:i.date,submissionEndTime:o.time,submissionEndDate:o.date,gracePeriod:t.gracePeriod,sessionVisibleSetting:t.sessionVisibleSetting,customSessionVisibleTime:(0,G.gW)(),customSessionVisibleDate:(0,G.l$)(),responseVisibleSetting:t.responseVisibleSetting,customResponseVisibleTime:(0,G.gW)(),customResponseVisibleDate:(0,G.l$)(),submissionStatus:t.submissionStatus,publishStatus:t.publishStatus,templateSessionName:"",isClosingSoonEmailEnabled:t.isClosingSoonEmailEnabled,isPublishedEmailEnabled:t.isPublishedEmailEnabled,isSaving:!1,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:t.sessionVisibleSetting!==C.Be.AT_OPEN||t.responseVisibleSetting!==C.KG.LATER,hasEmailSettingsPanelExpanded:!t.isClosingSoonEmailEnabled||!t.isPublishedEmailEnabled};if(this.studentDeadlines=t.studentDeadlines,this.instructorDeadlines=t.instructorDeadlines,t.customSessionVisibleTimestamp){const m=this.datetimeService.getDateTimeAtTimezone(t.customSessionVisibleTimestamp,t.timeZone,!0);a.customSessionVisibleTime=m.time,a.customSessionVisibleDate=m.date}if(t.customResponseVisibleTimestamp){const m=this.datetimeService.getDateTimeAtTimezone(t.customResponseVisibleTimestamp,t.timeZone,!0);a.customResponseVisibleTime=m.time,a.customResponseVisibleDate=m.date}return a}editExistingSessionHandler(){this.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(this.sessionEditFormModel));const t=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,!0),s=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,!0);let i=0;this.sessionEditFormModel.sessionVisibleSetting===C.Be.CUSTOM&&(i=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,!0));let o=0;this.sessionEditFormModel.responseVisibleSetting===C.KG.CUSTOM&&(o=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,!0)),this.deleteDeadlineExtensionsHandler(s).subscribe(a=>{a&&this.updateFeedbackSession(t,s,i,o)})}updateFeedbackSession(t,s,i,o){this.sessionEditFormModel.isSaving=!0,this.sessionEditFormModel.isEditable=!1,this.feedbackSessionsService.updateFeedbackSession(this.courseId,this.feedbackSessionName,{instructions:this.sessionEditFormModel.instructions,submissionStartTimestamp:t,submissionEndTimestamp:s,gracePeriod:this.sessionEditFormModel.gracePeriod,sessionVisibleSetting:this.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:i,responseVisibleSetting:this.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:o,isClosingSoonEmailEnabled:this.sessionEditFormModel.isClosingSoonEmailEnabled,isPublishedEmailEnabled:this.sessionEditFormModel.isPublishedEmailEnabled,studentDeadlines:this.studentDeadlines,instructorDeadlines:this.instructorDeadlines}).pipe((0,_.j)(()=>{this.sessionEditFormModel.isSaving=!1})).subscribe({next:a=>{this.sessionEditFormModel=this.getSessionEditFormModel(a),this.statusMessageService.showSuccessToast("The feedback session has been updated.")},error:a=>{this.sessionEditFormModel.isEditable=!0,this.statusMessageService.showErrorToast(a.error.message)}})}deleteDeadlineExtensionsHandler(t){const[s,i]=this.getIndividualDeadlinesToDelete(t);if(0===Object.values(s).length&&0===Object.values(i).length)return(0,p.of)(!0);const[a,m]=this.getAffectedIndividualModels(t,s,i),S=this.ngbModal.open(P.K);return S.componentInstance.modalType=P.R.SESSION_DELETE,S.componentInstance.selectedStudents=a,S.componentInstance.selectedInstructors=m,S.componentInstance.extensionTimestamp=t,S.componentInstance.feedbackSessionTimeZone=this.sessionEditFormModel.timeZone,new b.c(y=>{S.componentInstance.confirmExtensionCallbackEvent.subscribe(()=>{this.removeDeadlines(a,m),S.componentInstance.isSubmitting=!1,S.close(),y.next(!0)},()=>{y.next(!1)})})}getIndividualDeadlinesToDelete(t){return[k.I.getDeadlinesBeforeOrEqualToEndTime(this.studentDeadlines,t),k.I.getDeadlinesBeforeOrEqualToEndTime(this.instructorDeadlines,t)]}getAffectedIndividualModels(t,s,i){const o=this.studentsOfCourse.filter(y=>s[y.email]),a=this.instructorsOfCourse.filter(y=>i[y.email]);return[k.I.mapStudentsToStudentModels(o,s,t),k.I.mapInstructorsToInstructorModels(a,i,t)]}removeDeadlines(t,s){this.studentDeadlines=k.I.getUpdatedDeadlinesForDeletion(t,this.studentDeadlines),this.instructorDeadlines=k.I.getUpdatedDeadlinesForDeletion(s,this.instructorDeadlines)}cancelEditingSessionHandler(){this.sessionEditFormModel=JSON.parse(JSON.stringify(this.feedbackSessionModelBeforeEditing))}deleteExistingSessionHandler(){this.sessionEditFormModel.isDeleting=!0,this.feedbackSessionsService.moveSessionToRecycleBin(this.courseId,this.feedbackSessionName).pipe((0,_.j)(()=>{this.sessionEditFormModel.isDeleting=!1})).subscribe({next:()=>{this.navigationService.navigateWithSuccessMessage("/web/instructor/sessions","The feedback session has been deleted. You can restore it from the deleted sessions table below.")},error:t=>{this.statusMessageService.showErrorToast(t.error.message)}})}loadFeedbackQuestions(){this.questionEditFormModels=[],this.hasLoadingFeedbackQuestionsFailed=!1,this.isLoadingFeedbackQuestions=!0,this.feedbackQuestionsService.getFeedbackQuestions({courseId:this.courseId,feedbackSessionName:this.feedbackSessionName,intent:u.JD.FULL_DETAIL}).pipe((0,_.j)(()=>{this.isLoadingFeedbackQuestions=!1})).subscribe({next:t=>{t.questions.forEach(s=>{const i=this.getQuestionEditFormModel(s);this.questionEditFormModels.push(i),this.loadResponseStatusForQuestion(i),this.feedbackQuestionModels.set(s.feedbackQuestionId,s)})},error:t=>{this.hasLoadingFeedbackQuestionsFailed=!0,this.statusMessageService.showErrorToast(t.error.message)}})}trackQuestionEditFormByFn(t,s){return s.feedbackQuestionId}getQuestionEditFormModel(t){return{feedbackQuestionId:t.feedbackQuestionId,questionNumber:t.questionNumber,questionBrief:t.questionBrief,questionDescription:t.questionDescription,isQuestionHasResponses:!1,questionType:t.questionType,questionDetails:this.deepCopy(t.questionDetails),giverType:t.giverType,recipientType:t.recipientType,numberOfEntitiesToGiveFeedbackToSetting:t.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:t.customNumberOfEntitiesToGiveFeedbackTo?t.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:t.showResponsesTo,showGiverNameTo:t.showGiverNameTo,showRecipientNameTo:t.showRecipientNameTo,isDeleting:!1,isDuplicating:!1,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}loadResponseStatusForQuestion(t){this.feedbackSessionsService.hasResponsesForQuestion(t.feedbackQuestionId).subscribe({next:s=>{t.isQuestionHasResponses=s.hasResponses},error:s=>{this.statusMessageService.showErrorToast(s.error.message)}})}saveExistingQuestionHandler(t){const s=this.questionEditFormModels[t],i=this.feedbackQuestionModels.get(s.feedbackQuestionId).questionNumber;s.isSaving=!0,this.feedbackQuestionsService.saveFeedbackQuestion(s.feedbackQuestionId,{questionNumber:s.questionNumber,questionBrief:s.questionBrief,questionDescription:s.questionDescription,questionDetails:s.questionDetails,questionType:s.questionType,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo}).pipe((0,_.j)(()=>{s.isSaving=!1})).subscribe({next:o=>{this.questionEditFormModels[t]=this.getQuestionEditFormModel(o),this.feedbackQuestionModels.set(o.feedbackQuestionId,o),this.loadResponseStatusForQuestion(this.questionEditFormModels[t]),i!==o.questionNumber&&(this.moveQuestionForm(i-1,o.questionNumber-1),this.normalizeQuestionNumberInQuestionForms()),this.statusMessageService.showSuccessToast("The changes to the question have been updated.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})}moveQuestionForm(t,s){this.questionEditFormModels.splice(s,0,this.questionEditFormModels.splice(t,1)[0]);const i=Math.min(t,s),o=this.questionEditFormModels.slice(i,s+1).filter(a=>!a.isCollapsed);o.forEach(a=>{a.isCollapsed=!0}),this.changeDetectorRef.detectChanges(),o.forEach(a=>{a.isCollapsed=!1})}normalizeQuestionNumberInQuestionForms(){for(let t=1;t<=this.questionEditFormModels.length;t+=1){const s=this.questionEditFormModels[t-1];s.questionNumber=t,this.feedbackQuestionModels.get(s.feedbackQuestionId).questionNumber=t}}discardExistingQuestionHandler(t){const s=this.questionEditFormModels[t],i=this.feedbackQuestionModels.get(s.feedbackQuestionId);this.questionEditFormModels[t]=this.getQuestionEditFormModel(i),this.questionEditFormModels[t].isQuestionHasResponses=s.isQuestionHasResponses}duplicateCurrentQuestionHandler(t){const s=this.questionEditFormModels[t];s.isDuplicating=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.questionEditFormModels.length+1,questionBrief:s.questionBrief,questionDescription:s.questionDescription,questionDetails:s.questionDetails,questionType:s.questionType,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo}).pipe((0,_.j)(()=>{s.isDuplicating=!1})).subscribe({next:i=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(i)),this.feedbackQuestionModels.set(i.feedbackQuestionId,i),this.statusMessageService.showSuccessToast("The question has been duplicated below.")},error:i=>{this.statusMessageService.showErrorToast(i.error.message)}})}deleteExistingQuestionHandler(t){this.simpleModalService.openConfirmationModal("Delete the question?",re.i.DANGER,"Warning: Deleted question cannot be recovered. <b>All existing responses for this question to be deleted.</b>").result.then(()=>{const i=this.questionEditFormModels[t];i.isDeleting=!0,this.feedbackQuestionsService.deleteFeedbackQuestion(i.feedbackQuestionId).pipe((0,_.j)(()=>{i.isDeleting=!1})).subscribe({next:()=>{this.feedbackQuestionModels.delete(i.feedbackQuestionId),this.questionEditFormModels.splice(t,1),this.normalizeQuestionNumberInQuestionForms(),this.statusMessageService.showSuccessToast("The question has been deleted.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})},()=>{})}templateQuestionModalHandler(){this.ngbModal.open(se,{windowClass:"modal-large"}).result.then(s=>{let i=this.questionEditFormModels.length;this.isAddingFromTemplate=!0,(0,p.of)(...s).pipe((0,F.H)(o=>(i+=1,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:i,questionBrief:o.questionBrief,questionDescription:o.questionDescription,questionDetails:o.questionDetails,questionType:o.questionType,giverType:o.giverType,recipientType:o.recipientType,numberOfEntitiesToGiveFeedbackToSetting:o.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:o.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:o.showResponsesTo,showGiverNameTo:o.showGiverNameTo,showRecipientNameTo:o.showRecipientNameTo})))).pipe((0,_.j)(()=>{this.isAddingFromTemplate=!1})).subscribe({next:o=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(o)),this.feedbackQuestionModels.set(o.feedbackQuestionId,o)},error:o=>{this.statusMessageService.showErrorToast(o.error.message)},complete:()=>{this.statusMessageService.showSuccessToast(1===s.length?"The question has been added to this feedback session.":"The questions have been added to this feedback session.")}})},()=>{})}populateAndShowNewQuestionForm(t){this.isAddingQuestionPanelExpanded=!0;const s=this.feedbackQuestionsService.getNewQuestionModel(t);if(this.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:this.questionEditFormModels.length+1,questionBrief:s.questionBrief,questionDescription:s.questionDescription,isQuestionHasResponses:!1,questionType:s.questionType,questionDetails:s.questionDetails,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo?s.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo,isDeleting:!1,isDuplicating:!1,isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},this.questionEditFormModels.length>0){const i=this.questionEditFormModels[this.questionEditFormModels.length-1],o=this.feedbackQuestionsService.getAllowedFeedbackPaths(t);o.has(i.giverType)&&-1!==o.get(i.giverType).indexOf(i.recipientType)&&(this.newQuestionEditFormModel.giverType=i.giverType,this.newQuestionEditFormModel.recipientType=i.recipientType,this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting=i.numberOfEntitiesToGiveFeedbackToSetting,this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo=i.customNumberOfEntitiesToGiveFeedbackTo);const a=this.feedbackQuestionsService.getNewVisibilityStateMachine(this.newQuestionEditFormModel.giverType,this.newQuestionEditFormModel.recipientType);a.applyVisibilitySettings({SHOW_RESPONSE:i.showResponsesTo,SHOW_GIVER_NAME:i.showGiverNameTo,SHOW_RECIPIENT_NAME:i.showRecipientNameTo});const m=a.getVisibilityTypesUnderVisibilityControl(A.e.SHOW_RESPONSE),S=a.getVisibilityTypesUnderVisibilityControl(A.e.SHOW_GIVER_NAME),y=a.getVisibilityTypesUnderVisibilityControl(A.e.SHOW_RECIPIENT_NAME);let D=!1;if(this.feedbackQuestionsService.isCustomFeedbackVisibilitySettingAllowed(this.newQuestionEditFormModel.questionType))D=!0;else{const B=this.feedbackQuestionsService.getCommonFeedbackVisibilitySettings(a,this.newQuestionEditFormModel.questionType);for(const w of B)if(this.isSameSet(m,w.visibilitySettings.SHOW_RESPONSE)&&this.isSameSet(S,w.visibilitySettings.SHOW_GIVER_NAME)&&this.isSameSet(y,w.visibilitySettings.SHOW_RECIPIENT_NAME)){D=!0;break}}D&&(this.newQuestionEditFormModel.showResponsesTo=m,this.newQuestionEditFormModel.showGiverNameTo=S,this.newQuestionEditFormModel.showRecipientNameTo=y)}this.scrollToNewEditForm()}isSameSet(t,s){return t.length===s.length&&t.every(i=>s.includes(i))}createNewQuestionHandler(){this.newQuestionEditFormModel.isSaving=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.newQuestionEditFormModel.questionNumber,questionBrief:this.newQuestionEditFormModel.questionBrief,questionDescription:this.newQuestionEditFormModel.questionDescription,questionDetails:this.newQuestionEditFormModel.questionDetails,questionType:this.newQuestionEditFormModel.questionType,giverType:this.newQuestionEditFormModel.giverType,recipientType:this.newQuestionEditFormModel.recipientType,numberOfEntitiesToGiveFeedbackToSetting:this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:this.newQuestionEditFormModel.showResponsesTo,showGiverNameTo:this.newQuestionEditFormModel.showGiverNameTo,showRecipientNameTo:this.newQuestionEditFormModel.showRecipientNameTo}).pipe((0,_.j)(()=>{this.newQuestionEditFormModel.isSaving=!1})).subscribe({next:t=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(t)),this.feedbackQuestionModels.set(t.feedbackQuestionId,t),this.moveQuestionForm(this.questionEditFormModels.length-1,t.questionNumber-1),this.normalizeQuestionNumberInQuestionForms(),this.isAddingQuestionPanelExpanded=!1,this.statusMessageService.showSuccessToast("The question has been added to this feedback session.")},error:t=>{this.statusMessageService.showErrorToast(t.error.message)}})}copyQuestionsFromOtherSessionsHandler(){this.isCopyingQuestion=!0;const t=[];this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe((0,_.j)(()=>{this.isCopyingQuestion=!1})).subscribe({next:s=>{s.feedbackSessions.forEach(i=>{t.push({courseId:i.courseId,feedbackSessionName:i.feedbackSessionName,createdAtTimestamp:i.createdAtTimestamp,questionsTableRowModels:[],isTabExpanded:!1,hasQuestionsLoaded:!1,hasLoadingFailed:!1,questionsTableRowModelsSortBy:l.g.NONE,questionsTableRowModelsSortOrder:l.x.ASC})})},error:s=>{this.statusMessageService.showErrorToast(s.error.message)},complete:()=>{const s=this.ngbModal.open(K);s.componentInstance.feedbackSessionTabModels=t,s.result.then(i=>{this.isCopyingQuestion=!0,(0,p.of)(...i).pipe((0,F.H)(o=>this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.questionEditFormModels.length+1,questionBrief:o.questionBrief,questionDescription:o.questionDescription,questionDetails:o.questionDetails,questionType:o.questionType,giverType:o.giverType,recipientType:o.recipientType,numberOfEntitiesToGiveFeedbackToSetting:o.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:o.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:o.showResponsesTo,showGiverNameTo:o.showGiverNameTo,showRecipientNameTo:o.showRecipientNameTo})),(0,_.j)(()=>{this.isCopyingQuestion=!1})).subscribe({next:o=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(o)),this.feedbackQuestionModels.set(o.feedbackQuestionId,o),this.statusMessageService.showSuccessToast("The selected question(s) have been added to this feedback session.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})})}})}getAllStudentsOfCourse(){this.studentService.getStudentsFromCourse({courseId:this.courseId}).subscribe({next:t=>{this.studentsOfCourse=t.students,this.studentsOfCourse.sort((s,i)=>{const o=s.teamName.localeCompare(i.teamName);return 0===o?s.name.localeCompare(i.name):o}),this.studentsOfCourse.length>=1&&(this.emailOfStudentToPreview=this.studentsOfCourse[0].email)},error:t=>{this.statusMessageService.showErrorToast(t.error.message)}})}getAllInstructors(){this.instructorService.loadInstructors({courseId:this.courseId,intent:u.JD.FULL_DETAIL}).subscribe({next:t=>{this.instructorsOfCourse=t.instructors,this.instructorsOfCourse.sort((s,i)=>s.name.localeCompare(i.name)),this.instructorsOfCourse.length>=1&&(this.emailOfInstructorToPreview=this.instructorsOfCourse[0].email)},error:t=>{this.statusMessageService.showErrorToast(t.error.message)}})}expandAll(){this.questionEditFormModels.forEach(t=>{t.isCollapsed=!1})}collapseAll(){this.questionEditFormModels.forEach(t=>{t.isCollapsed=!0})}deepCopy(t){return JSON.parse(JSON.stringify(t))}scrollToNewEditForm(){setTimeout(()=>{const t=document.querySelectorAll("tm-question-edit-form"),o=t[t.length-1].getBoundingClientRect().top+window.scrollY+-70;window.scrollTo({top:o,behavior:"smooth"})},0)}scrollToTopOfPage(){window.scrollTo({top:0,behavior:"smooth"})}static#e=this.\u0275fac=function(s){return new(s||r)(e.rXU(de.p),e.rXU(h.x),e.rXU(le.o),e.rXU(ce.u),e.rXU(v.q),e.rXU(x.C),e.rXU(g.Bq),e.rXU(ue.r),e.rXU(me.W),e.rXU(pe.Y),e.rXU(he.D),e.rXU(fe.D),e.rXU(ge.b),e.rXU(_e.f),e.rXU(E.nX),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:r,selectors:[["tm-instructor-session-edit-page"]],viewQuery:function(s,i){if(1&s&&e.GBs(Se,5),2&s){let o;e.mGM(o=e.lsd())&&(i.modifiedTimestampsModal=o.first)}},features:[e.Vt3],decls:13,vars:11,consts:[[3,"shouldShowRetry","message","retryEvent"],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent",4,"tmIsLoading"],["class","offset-md-10 margin-vertical-20px",4,"ngIf"],[4,"tmIsLoading"],["class","card",4,"ngIf"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange",4,"ngIf"],["modifiedTimestampsModal",""],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent"],[1,"offset-md-10","margin-vertical-20px"],["id","btn-collapse-expand",1,"btn","expand-btn","btn-light","margin-top-30px",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-block","text-end","cursor-pointer",3,"click"],[1,"fas","fa-arrow-up"],[3,"formMode","numOfQuestions","formModel","isQuestionPublished","saveExistingQuestionEvent","discardExistingQuestionChangesEvent","duplicateCurrentQuestionEvent","deleteCurrentQuestionEvent","formModelChange"],[1,"card"],[3,"isCopyingQuestion","templateQuestionModalEvent","populateAndShowNewQuestionFormEvent","copyQuestionsFromOtherSessionsEvent"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange"],[3,"courseId","feedbackSessionName","emailOfStudentToPreview","studentsOfCourse","instructorsCanBePreviewedAs","emailOfInstructorToPreview"],[3,"coursesOfModifiedSession","modifiedSessions"]],template:function(s,i){1&s&&(e.j41(0,"tm-loading-retry",0),e.bIt("retryEvent",function(){return i.loadFeedbackSession()}),e.DNE(1,Me,1,2,"tm-session-edit-form",1),e.k0s(),e.j41(2,"tm-loading-retry",0),e.bIt("retryEvent",function(){return i.loadFeedbackQuestions()}),e.DNE(3,Fe,3,1,"div",2),e.DNE(4,ye,5,2,"div",3),e.DNE(5,Ne,1,0,"div",3),e.nrm(6,"br"),e.DNE(7,Ie,2,1,"div",4),e.DNE(8,Qe,1,3,"tm-question-edit-form",5),e.nrm(9,"br"),e.DNE(10,ke,2,6,"div",4),e.k0s(),e.DNE(11,Oe,1,2,"ng-template",null,6,e.C5r)),2&s&&(e.Y8G("shouldShowRetry",i.hasLoadingFeedbackSessionFailed)("message","Failed to load feedback session"),e.R7$(1),e.Y8G("tmIsLoading",i.isLoadingFeedbackSession),e.R7$(1),e.Y8G("shouldShowRetry",i.hasLoadingFeedbackQuestionsFailed)("message","Failed to load feedback questions"),e.R7$(1),e.Y8G("ngIf",!i.isLoadingFeedbackQuestions&&i.questionEditFormModels.length),e.R7$(1),e.Y8G("tmIsLoading",i.isLoadingFeedbackQuestions),e.R7$(1),e.Y8G("tmIsLoading",i.isAddingFromTemplate),e.R7$(2),e.Y8G("ngIf",!i.isLoadingFeedbackQuestions&&!i.isAddingQuestionPanelExpanded),e.R7$(1),e.Y8G("ngIf",i.isAddingQuestionPanelExpanded),e.R7$(2),e.Y8G("ngIf",!i.isLoadingFeedbackQuestions))},dependencies:[Ee.H,d.Sq,d.bT,be.I,j.E,O.n,Q.Y,Te.W,ve.U],styles:[".expand-btn[_ngcontent-%COMP%]{width:100%}.margin-vertical-20px[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:20px}.text-color-lightgray[_ngcontent-%COMP%]{color:#d3d3d3}"]})}return r})();var De=n(65949),we=n(85385),xe=n(21079),qe=n(1829),Ge=n(34029),Ae=n(84309),Be=n(28324),je=n(57125),Pe=n(11889),Le=n(36650),Ve=n(16781),Ue=n(44661),Xe=n(48381);const $e=[{path:"",component:Re}];let Ye=(()=>{class r{static#e=this.\u0275fac=function(s){return new(s||r)};static#t=this.\u0275mod=e.$C({type:r});static#s=this.\u0275inj=e.G2t({imports:[De.A,we.D,d.MD,c.YN,g.HC,g.zH,g.n8,Ue.x,Ve.$,Le.j,xe.Z,E.iI.forChild($e),Ae.y,Ge.Z,Xe.d,Pe.H,je.o,qe.X,Be.t]})}return r})()},2578:function(N,T){var n,c;void 0!==(c="function"==typeof(n=function(){"use strict";function g(u,l,e){var h=new XMLHttpRequest;h.open("GET",u),h.responseType="blob",h.onload=function(){F(h.response,l,e)},h.onerror=function(){console.error("could not download file")},h.send()}function M(u){var l=new XMLHttpRequest;l.open("HEAD",u,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function p(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(l)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,_=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),F=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!_?function(u,l,e){var h=b.URL||b.webkitURL,v=document.createElement("a");v.download=l=l||u.name||"download",v.rel="noopener","string"==typeof u?(v.href=u,v.origin===location.origin?p(v):M(v.href)?g(u,l,e):p(v,v.target="_blank")):(v.href=h.createObjectURL(u),setTimeout(function(){h.revokeObjectURL(v.href)},4e4),setTimeout(function(){p(v)},0))}:"msSaveOrOpenBlob"in navigator?function(u,l,e){if(l=l||u.name||"download","string"!=typeof u)navigator.msSaveOrOpenBlob(function E(u,l){return typeof l>"u"?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\ufeff",u],{type:u.type}):u}(u,e),l);else if(M(u))g(u,l,e);else{var h=document.createElement("a");h.href=u,h.target="_blank",setTimeout(function(){p(h)})}}:function(u,l,e,h){if((h=h||open("","_blank"))&&(h.document.title=h.document.body.innerText="downloading..."),"string"==typeof u)return g(u,l,e);var v="application/octet-stream"===u.type,x=/constructor/i.test(b.HTMLElement)||b.safari,O=/CriOS\/[\d]+/.test(navigator.userAgent);if((O||v&&x||_)&&typeof FileReader<"u"){var Q=new FileReader;Q.onloadend=function(){var I=Q.result;I=O?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=I:location=I,h=null},Q.readAsDataURL(u)}else{var q=b.URL||b.webkitURL,R=q.createObjectURL(u);h?h.location=R:location.href=R,h=null,setTimeout(function(){q.revokeObjectURL(R)},4e4)}});b.saveAs=F.saveAs=F,N.exports=F})?n.apply(T,[]):n)&&(N.exports=c)}}]);