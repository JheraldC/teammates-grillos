"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[6421],{16421:(w,p,l)=>{l.r(p),l.d(p,{UsageStatisticsPageModule:()=>k});var f=l(60177),h=l(89417),v=l(82646),u=l(94227),d=l(70273),t=l(17705);let T=(()=>{class a{constructor(i){this.chartElem=i,this.timeRange={startTime:0,endTime:0},this.width=700,this.height=700,this.margin=50}ngOnChanges(i){i.data&&this.data&&this.timeRange&&(this.initializeChart(),this.drawChart(),window.addEventListener("resize",()=>this.drawChart()))}initializeChart(){this.svg&&d.Ltv("svg").remove();const i=new Date(this.timeRange.startTime),s=new Date(this.timeRange.endTime);this.svg=d.Ltv(this.chartElem.nativeElement).select(".line-chart").append("svg").attr("height",this.height),this.svgInner=this.svg.append("g").style("transform",`translate(${this.margin}px, ${this.margin}px)`),this.yScale=d.m4Y().domain([(d.T9B(this.data,e=>e.value)||0)+1,(d.jkA(this.data,e=>e.value)||0)-1]).range([0,this.height-2*this.margin]),this.xScale=d.w7C().domain([i,s]),this.yAxis=this.svgInner.append("g").attr("id","y-axis").style("transform",`translate(${this.margin}px, 0)`),this.xAxis=this.svgInner.append("g").attr("id","x-axis").style("transform",`translate(0, ${this.height-2*this.margin}px)`),this.lineGroup=this.svgInner.append("g").append("path").attr("id","line").style("fill","none").style("stroke","#007BFF").style("stroke-width","2px")}drawChart(){this.width=this.chartElem.nativeElement.getBoundingClientRect().width,this.svg.attr("width",this.width),this.xScale.range([this.margin,this.width-2*this.margin]);const i=d.l78(this.xScale).ticks(10).tickFormat(n=>d.DCK("%b %d, %H:%M")(n));this.xAxis.call(i);const s=d.V4s(this.yScale);this.yAxis.call(s);const e=d.n8j().x(n=>n[0]).y(n=>n[1]),o=this.data.map(n=>[this.xScale(new Date(n.date)),this.yScale(n.value)]);this.lineGroup.attr("d",e(o));const r=d.Ltv("div.tooltip");this.svgInner.selectAll("dot").data(this.data).enter().append("circle").attr("r",3).attr("cx",n=>this.xScale(new Date(n.date))).attr("cy",n=>this.yScale(n.value)).attr("fill","#FFC107").on("mouseover",(n,M)=>{r.transition().duration(200).style("opacity",.9),r.html(`Time: ${new Date(M.date).toString()}<br>New ${this.dataName} count: ${M.value}`).style("left",`${n.pageX}px`).style("top",n.pageY-32+"px")}).on("mouseout",()=>{r.transition().duration(500).style("opacity",0)})}static#t=this.\u0275fac=function(s){return new(s||a)(t.rXU(t.aKT))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["tm-stats-line-chart"]],inputs:{data:"data",timeRange:"timeRange",dataName:"dataName"},features:[t.OA$],decls:2,vars:0,consts:[[1,"line-chart"],[1,"tooltip",2,"opacity","0"]],template:function(s,e){1&s&&t.nrm(0,"div",0)(1,"div",1)},styles:["div.tooltip[_ngcontent-%COMP%]{position:absolute;text-align:left;padding:2px;font:12px sans-serif;background:lightsteelblue;border:0;border-radius:8px;pointer-events:none}"]})}return a})();var c=l(47650),U=l(8059),C=l(16507);let y=(()=>{class a{constructor(i){this.httpRequestService=i}getUsageStatistics(i,s){return this.httpRequestService.get(U.Ld.USAGE_STATISTICS,{starttime:`${i}`,endtime:`${s}`})}static#t=this.\u0275fac=function(s){return new(s||a)(t.KVO(C.R))};static#e=this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var D=l(50833),N=l(30715);function R(a,F){if(1&a&&t.nrm(0,"tm-stats-line-chart",27),2&a){const i=t.XpG(2);t.Y8G("data",i.dataToDraw)("timeRange",i.timeRange)("dataName",i.itemName)}}function E(a,F){if(1&a&&(t.j41(0,"div"),t.DNE(1,R,1,3,"tm-stats-line-chart",26),t.k0s()),2&a){const i=t.XpG();t.R7$(1),t.Y8G("tmIsLoading",i.isLoading)}}var g=function(a){return a[a.NUM_RESPONSES=0]="NUM_RESPONSES",a[a.NUM_COURSES=1]="NUM_COURSES",a[a.NUM_STUDENTS=2]="NUM_STUDENTS",a[a.NUM_INSTRUCTORS=3]="NUM_INSTRUCTORS",a[a.NUM_ACCOUNT_REQUESTS=4]="NUM_ACCOUNT_REQUESTS",a[a.NUM_EMAILS=5]="NUM_EMAILS",a[a.NUM_SUBMISSIONS=6]="NUM_SUBMISSIONS",a}(g||{}),m=function(a){return a[a.HOURLY=0]="HOURLY",a[a.DAILY=1]="DAILY",a}(m||{});let S=(()=>{class a{constructor(i,s,e){this.usageStatisticsService=i,this.timezoneService=s,this.statusMessageService=e,this.StatisticsType=g,this.AggregationType=m,this.itemName="responses",this.formModel={fromDate:(0,c.l$)(),fromTime:(0,c.qt)(),toDate:(0,c.l$)(),toTime:(0,c.qt)(),dataType:g.NUM_RESPONSES,aggregationType:m.HOURLY},this.dateToday=(0,c.l$)(),this.earliestSearchDate={year:2016,month:1,day:1},this.timeRange={startTime:0,endTime:0},this.hasQueried=!1,this.isLoading=!1,this.fetchedData=[],this.dataToDraw=[],this.timezone="UTC"}ngOnInit(){this.timezone=this.timezoneService.guessTimezone();const i=new Date;this.dateToday.year=i.getFullYear(),this.dateToday.month=i.getMonth()+1,this.dateToday.day=i.getDate();const s=new Date(i.getTime()-c.l5.IN_ONE_WEEK);this.formModel.fromDate={year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate()},this.formModel.toDate={...this.dateToday},this.formModel.fromTime={hour:s.getHours(),minute:s.getMinutes()},this.formModel.toTime={hour:i.getHours(),minute:i.getMinutes()}}getUsageStatistics(){this.hasQueried=!0,this.isLoading=!0;const i=this.timezoneService.resolveLocalDateTime(this.formModel.fromDate,this.formModel.fromTime,this.timezone),s=this.timezoneService.resolveLocalDateTime(this.formModel.toDate,this.formModel.toTime,this.timezone);this.usageStatisticsService.getUsageStatistics(i,s).subscribe({next:e=>{this.timeRange={startTime:i,endTime:s},this.fetchedData=e.result,this.drawLineChart(),this.isLoading=!1},error:e=>{this.statusMessageService.showErrorToast(e.error.message),this.isLoading=!1}})}changeStatsType(i){this.formModel.dataType=i,this.drawLineChart()}changeAggregationType(i){this.formModel.aggregationType=i,this.drawLineChart()}drawLineChart(){if(!this.fetchedData.length)return;+this.formModel.aggregationType===m.DAILY&&this.fetchedData.length<168?(this.statusMessageService.showWarningToast("There is too little data to be aggregated daily."),this.formModel.aggregationType=m.HOURLY):+this.formModel.aggregationType===m.HOURLY&&this.fetchedData.length>720&&(this.statusMessageService.showWarningToast("There is too many data to be aggregated hourly."),this.formModel.aggregationType=m.DAILY);const i=+this.formModel.aggregationType===m.DAILY;let s=this.fetchedData.map(e=>{let o;switch(+this.formModel.dataType){case g.NUM_RESPONSES:o=e.numResponses,this.itemName="responses";break;case g.NUM_COURSES:o=e.numCourses,this.itemName="courses";break;case g.NUM_STUDENTS:o=e.numStudents,this.itemName="students";break;case g.NUM_INSTRUCTORS:o=e.numInstructors,this.itemName="instructors";break;case g.NUM_ACCOUNT_REQUESTS:o=e.numAccountRequests,this.itemName="account requests";break;case g.NUM_EMAILS:o=e.numEmails,this.itemName="emails sent";break;case g.NUM_SUBMISSIONS:o=e.numSubmissions,this.itemName="submissions";break;default:throw new Error("Unexpected statsType")}return{value:o,date:new Date(e.startTime).toISOString()}});if(i){const e=[];let o={value:0,date:s[0].date};for(const r of s)0===new Date(r.date).getUTCHours()?(e.push(o),o={value:r.value,date:r.date}):o.value+=r.value;e.push(o),s=e}this.dataToDraw=s}static#t=this.\u0275fac=function(s){return new(s||a)(t.rXU(y),t.rXU(D.D),t.rXU(N.x))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["tm-usage-statistics-page"]],decls:63,vars:22,consts:[[1,"card","bg-form","no-border"],[1,"card-body"],[1,"row","form-group"],[1,"col-4"],[1,"col-12","mb-1"],["for","search-from-datepicker",1,"fw-bold"],[1,"row"],[1,"col-6"],[1,"input-group"],["id","search-from-datepicker","type","text","ngbDatepicker","",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsFromDp","ngbDatepicker"],["type","button",1,"btn","btn-light","input-group-text",3,"click"],[1,"fas","fa-calendar-alt"],[3,"ngModel","spinners","ngModelChange"],["for","search-to-datepicker",1,"fw-bold"],["id","search-to-datepicker","type","text","ngbDatepicker","",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsToDp","ngbDatepicker"],[1,"col-2"],["for","data-to-display",1,"fw-bold"],["id","data-to-display",1,"form-control","form-select","col-12",3,"ngModel","ngModelChange"],[3,"value"],["for","data-aggregation",1,"fw-bold"],["id","data-aggregation",1,"form-control","form-select","col-12",3,"ngModel","ngModelChange"],[1,"col-1","mt-4"],["id","query-button",1,"float-end","btn","btn-primary",3,"click"],[4,"ngIf"],[3,"data","timeRange","dataName",4,"tmIsLoading"],[3,"data","timeRange","dataName"]],template:function(s,e){if(1&s){const o=t.RV6();t.j41(0,"p"),t.EFF(1,"Data available from: 1 January 2016, 00:00 UTC"),t.k0s(),t.j41(2,"div",0)(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"label",5),t.EFF(8,"Search period from"),t.k0s()(),t.j41(9,"div",6)(10,"div",7)(11,"div",8)(12,"input",9,10),t.bIt("ngModelChange",function(n){return e.formModel.fromDate=n}),t.k0s(),t.j41(14,"button",11),t.bIt("click",function(){t.eBV(o);const n=t.sdS(13);return t.Njj(n.toggle())}),t.nrm(15,"i",12),t.k0s()()(),t.j41(16,"div",7)(17,"ngb-timepicker",13),t.bIt("ngModelChange",function(n){return e.formModel.fromTime=n}),t.k0s()()()(),t.j41(18,"div",3)(19,"div",4)(20,"label",14),t.EFF(21,"Search period until"),t.k0s()(),t.j41(22,"div",6)(23,"div",7)(24,"div",8)(25,"input",15,16),t.bIt("ngModelChange",function(n){return e.formModel.toDate=n}),t.k0s(),t.j41(27,"button",11),t.bIt("click",function(){t.eBV(o);const n=t.sdS(26);return t.Njj(n.toggle())}),t.nrm(28,"i",12),t.k0s()()(),t.j41(29,"div",7)(30,"ngb-timepicker",13),t.bIt("ngModelChange",function(n){return e.formModel.toTime=n}),t.k0s()()()(),t.j41(31,"div",17)(32,"div",4)(33,"label",18),t.EFF(34,"Data to display:"),t.k0s()(),t.j41(35,"select",19),t.bIt("ngModelChange",function(n){return e.changeStatsType(n)}),t.j41(36,"option",20),t.EFF(37,"# of responses"),t.k0s(),t.j41(38,"option",20),t.EFF(39,"# of courses"),t.k0s(),t.j41(40,"option",20),t.EFF(41,"# of students"),t.k0s(),t.j41(42,"option",20),t.EFF(43,"# of instructors"),t.k0s(),t.j41(44,"option",20),t.EFF(45,"# of account requests"),t.k0s(),t.j41(46,"option",20),t.EFF(47,"# of emails"),t.k0s(),t.j41(48,"option",20),t.EFF(49,"# of submissions"),t.k0s()()(),t.j41(50,"div",17)(51,"div",4)(52,"label",21),t.EFF(53,"Data aggregation:"),t.k0s()(),t.j41(54,"select",22),t.bIt("ngModelChange",function(n){return e.changeAggregationType(n)}),t.j41(55,"option",20),t.EFF(56,"Hourly"),t.k0s(),t.j41(57,"option",20),t.EFF(58,"Daily"),t.k0s()()(),t.j41(59,"div",23)(60,"button",24),t.bIt("click",function(){return e.getUsageStatistics()}),t.EFF(61,"Query"),t.k0s()()()()(),t.DNE(62,E,2,1,"div",25)}2&s&&(t.R7$(12),t.Y8G("minDate",e.earliestSearchDate)("maxDate",e.dateToday)("ngModel",e.formModel.fromDate),t.R7$(5),t.Y8G("ngModel",e.formModel.fromTime)("spinners",!1),t.R7$(8),t.Y8G("minDate",e.earliestSearchDate)("maxDate",e.dateToday)("ngModel",e.formModel.toDate),t.R7$(5),t.Y8G("ngModel",e.formModel.toTime)("spinners",!1),t.R7$(5),t.Y8G("ngModel",e.formModel.dataType),t.R7$(1),t.Y8G("value",e.StatisticsType.NUM_RESPONSES),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_COURSES),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_STUDENTS),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_INSTRUCTORS),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_ACCOUNT_REQUESTS),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_EMAILS),t.R7$(2),t.Y8G("value",e.StatisticsType.NUM_SUBMISSIONS),t.R7$(6),t.Y8G("ngModel",e.formModel.aggregationType),t.R7$(1),t.Y8G("value",e.AggregationType.HOURLY),t.R7$(2),t.Y8G("value",e.AggregationType.DAILY),t.R7$(5),t.Y8G("ngIf",e.hasQueried))},styles:[".bg-form[_ngcontent-%COMP%]{background-color:#eaeff5}.no-border[_ngcontent-%COMP%]{border:0}@media (width <= 768px){.col-4[_ngcontent-%COMP%], .col-2[_ngcontent-%COMP%], .col-1[_ngcontent-%COMP%]{width:auto}}"]})}return a})();var _=l(84309),b=l(57645);const I=[{path:"",component:S}];let k=(()=>{class a{static#t=this.\u0275fac=function(s){return new(s||a)};static#e=this.\u0275mod=t.$C({type:a});static#a=this.\u0275inj=t.G2t({imports:[f.MD,v.iI.forChild(I),u.IQ,u.tJ,h.YN,_.y]})}return a})();t.wjB(S,function(){return[f.bT,u.cw,u.Pe,h.xH,h.y7,h.me,h.wz,h.BC,h.vS,b.n,T]},[])}}]);