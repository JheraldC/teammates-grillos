"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[9581],{86082:(T,_,o)=>{o.d(_,{F:()=>b});var r=o(17705),d=o(60177);function f(m,S){if(1&m&&r.nrm(0,"i",3),2&m){const p=r.XpG();r.xc7("color",p.chevronColor)}}function g(m,S){if(1&m&&r.nrm(0,"i",4),2&m){const p=r.XpG();r.xc7("color",p.chevronColor)}}let b=(()=>{class m{constructor(){this.isExpanded=!1,this.chevronColor="white"}static#t=this.\u0275fac=function(u){return new(u||m)};static#e=this.\u0275cmp=r.VBU({type:m,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded",chevronColor:"chevronColor"},decls:3,vars:3,consts:[["type","button","aria-label","Expand panel",1,"chevron","btn-course","btn","btn-primary","btn-sm"],["class","fas fa-chevron-down",3,"color",4,"ngIf"],["class","fas fa-chevron-up",3,"color",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(u,t){1&u&&(r.j41(0,"button",0),r.DNE(1,f,1,2,"i",1),r.DNE(2,g,1,2,"i",2),r.k0s()),2&u&&(r.BMQ("aria-expanded",t.isExpanded),r.R7$(1),r.Y8G("ngIf",!t.isExpanded),r.R7$(1),r.Y8G("ngIf",t.isExpanded))},dependencies:[d.bT],styles:["button.chevron[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;background-color:inherit;border-width:0}button.chevron[_ngcontent-%COMP%]:active{background-color:inherit}"]})}return m})()},57125:(T,_,o)=>{o.d(_,{o:()=>f});var r=o(60177),d=o(17705);let f=(()=>{class g{static#t=this.\u0275fac=function(S){return new(S||g)};static#e=this.\u0275mod=d.$C({type:g});static#n=this.\u0275inj=d.G2t({imports:[r.MD]})}return g})()},29581:(T,_,o)=>{o.r(_),o.d(_,{AdminSessionsPageModule:()=>B});var r=o(60177),d=o(89417),f=o(82646),g=o(94227),b=o(96508),m=o.n(b),S=o(70980),p=o(47650),u=o(44199),t=o(17705),F=o(50833),C=o(30715),k=o(43743),j=o(57645),E=o(86082);function M(i,c){if(1&i&&(t.j41(0,"option",33),t.EFF(1),t.k0s()),2&i){const e=c.$implicit;t.Y8G("value",e),t.R7$(1),t.JRh(e)}}function P(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",12)(5,"div",14)(6,"label",15),t.EFF(7,"From"),t.k0s()()(),t.j41(8,"div",12)(9,"div",14)(10,"form")(11,"div",16)(12,"div",17)(13,"input",18,19),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.startDate=n)}),t.k0s(),t.j41(15,"button",20),t.bIt("click",function(){t.eBV(e);const n=t.sdS(14);return t.Njj(n.toggle())}),t.nrm(16,"i",21),t.k0s()()()()(),t.j41(17,"div",14)(18,"ngb-timepicker",22),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.startTime=n)}),t.k0s()()()(),t.j41(19,"div",23)(20,"div",12)(21,"div",14)(22,"label",15),t.EFF(23,"To"),t.k0s()()(),t.j41(24,"div",12)(25,"div",14)(26,"form")(27,"div",16)(28,"div",17)(29,"input",24,25),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.endDate=n)}),t.k0s(),t.j41(31,"button",20),t.bIt("click",function(){t.eBV(e);const n=t.sdS(30);return t.Njj(n.toggle())}),t.nrm(32,"i",21),t.k0s()()()()(),t.j41(33,"div",14)(34,"ngb-timepicker",22),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.endTime=n)}),t.k0s()()()(),t.j41(35,"div",26)(36,"div",12)(37,"div",27)(38,"label",28),t.EFF(39,"Time Zone"),t.k0s()()(),t.j41(40,"div",12)(41,"div",14)(42,"select",29),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.filterTimezone=n)}),t.DNE(43,M,2,2,"option",30),t.k0s()(),t.j41(44,"div",31)(45,"button",32),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.getFeedbackSessions())}),t.EFF(46," Filter by Range "),t.k0s()()()()()()()}if(2&i){const e=t.XpG();t.R7$(13),t.Y8G("ngModel",e.startDate),t.R7$(5),t.Y8G("ngModel",e.startTime)("spinners",!1),t.R7$(11),t.Y8G("ngModel",e.endDate),t.R7$(5),t.Y8G("ngModel",e.endTime)("spinners",!1),t.R7$(8),t.Y8G("ngModel",e.filterTimezone),t.R7$(1),t.Y8G("ngForOf",e.timezones)}}function R(i,c){1&i&&(t.j41(0,"div",34),t.EFF(1," Currently No Ongoing Sessions "),t.k0s())}function D(i,c){if(1&i&&(t.j41(0,"option",33),t.EFF(1),t.k0s()),2&i){const e=c.$implicit;t.Y8G("value",e),t.R7$(1),t.JRh(e)}}function y(i,c){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(1),t.JRh(e.responseRate)}}function I(i,c){if(1&i){const e=t.RV6();t.j41(0,"span")(1,"a",53),t.bIt("click",function(n){t.eBV(e);const a=t.XpG().$implicit,l=t.XpG(2).$implicit,h=t.XpG(3);return t.Njj(h.getResponseRate(l.key,a.ongoingSession.courseId,a.ongoingSession.feedbackSessionName,n))}),t.EFF(2,"Show"),t.k0s()()}}function $(i,c){if(1&i&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td",50)(4,"strong"),t.EFF(5),t.k0s(),t.EFF(6),t.k0s(),t.j41(7,"td"),t.DNE(8,y,2,1,"span",51),t.DNE(9,I,3,0,"span",51),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s(),t.j41(14,"td")(15,"a",52),t.EFF(16),t.k0s()()()),2&i){const e=c.$implicit;t.R7$(2),t.JRh(e.ongoingSession.sessionStatus),t.R7$(3),t.SpI("[",e.ongoingSession.courseId,"]"),t.R7$(1),t.SpI(" ",e.ongoingSession.feedbackSessionName," "),t.R7$(2),t.Y8G("ngIf",e.responseRate),t.R7$(1),t.Y8G("ngIf",!e.responseRate),t.R7$(2),t.JRh(e.startTimeString),t.R7$(2),t.JRh(e.endTimeString),t.R7$(2),t.Y8G("href",e.ongoingSession.instructorHomePageLink,t.B4B),t.R7$(1),t.JRh(e.ongoingSession.creatorEmail)}}function A(i,c){if(1&i&&(t.j41(0,"div",46)(1,"div",47)(2,"table",48)(3,"thead")(4,"tr")(5,"th"),t.EFF(6,"Status"),t.k0s(),t.j41(7,"th"),t.EFF(8,"[Course ID] Session Name"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Response Rate"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Start Time"),t.k0s(),t.j41(13,"th"),t.EFF(14,"End Time"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Creator"),t.k0s()()(),t.j41(17,"tbody"),t.DNE(18,$,17,9,"tr",49),t.k0s()()()()),2&i){const e=t.XpG().$implicit;t.Y8G("@collapseAnim",void 0),t.R7$(18),t.Y8G("ngForOf",e.value)}}function O(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",41)(1,"div",42),t.bIt("click",function(){const a=t.eBV(e).$implicit,l=t.XpG(3);return t.Njj(l.institutionPanelsStatus[a.key]=!l.institutionPanelsStatus[a.key])}),t.j41(2,"strong"),t.EFF(3),t.k0s(),t.j41(4,"div",43),t.nrm(5,"tm-panel-chevron",44),t.k0s()(),t.DNE(6,A,19,2,"div",45),t.k0s()}if(2&i){const e=c.$implicit,s=t.XpG(3);t.R7$(3),t.Lme("",e.key," - Number of sessions: ",e.value.length,""),t.R7$(2),t.Y8G("isExpanded",s.institutionPanelsStatus[e.key]),t.R7$(1),t.Y8G("ngIf",s.institutionPanelsStatus[e.key])}}function G(i,c){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"div",36)(2,"div",37),t.EFF(3," Display session start/end time in this time zone: "),t.k0s(),t.j41(4,"div",38)(5,"select",39),t.bIt("ngModelChange",function(n){t.eBV(e);const a=t.XpG(2);return t.Njj(a.tableTimezone=n)})("ngModelChange",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.updateDisplayedTimes())}),t.DNE(6,D,2,2,"option",30),t.k0s()()(),t.DNE(7,O,7,4,"div",40),t.nI1(8,"keyvalue"),t.k0s()}if(2&i){const e=t.XpG(2);t.R7$(5),t.Y8G("ngModel",e.tableTimezone),t.R7$(1),t.Y8G("ngForOf",e.timezones),t.R7$(1),t.Y8G("ngForOf",t.bMT(8,3,e.sessions))}}function x(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,G,9,5,"div",35),t.k0s()),2&i){const e=t.XpG(),s=t.sdS(19);t.R7$(1),t.Y8G("ngIf",e.totalOngoingSessions)("ngIfElse",s)}}let z=(()=>{class i{constructor(e,s,n){this.timezoneService=e,this.statusMessageService=s,this.feedbackSessionsService=n,this.totalOngoingSessions=0,this.totalOpenSessions=0,this.totalClosedSessions=0,this.totalAwaitingSessions=0,this.totalInstitutes=0,this.sessions={},this.institutionPanelsStatus={},this.showFilter=!1,this.timezones=[],this.filterTimezone="",this.tableTimezone="",this.startDate=(0,p.l$)(),this.startTime=(0,p.gW)(),this.endDate=(0,p.l$)(),this.endTime=(0,p.gW)(),this.timezoneString="",this.startTimeString="",this.endTimeString="",this.isLoadingOngoingSessions=!1}ngOnInit(){this.timezones=Object.keys(this.timezoneService.getTzOffsets()),this.filterTimezone=this.timezoneService.guessTimezone(),this.tableTimezone=this.timezoneService.guessTimezone();const e=m()();this.startDate={year:e.year(),month:e.month()+1,day:e.date()},this.startTime={hour:e.hour(),minute:e.minute()},this.endTime={hour:e.hour(),minute:e.minute()};const s=m()(e).add(1,"weeks");this.endDate={year:s.year(),month:s.month()+1,day:s.date()},this.getFeedbackSessions()}openAllInstitutions(){for(const e of Object.keys(this.institutionPanelsStatus))this.institutionPanelsStatus[e]=!0}closeAllInstitutions(){for(const e of Object.keys(this.institutionPanelsStatus))this.institutionPanelsStatus[e]=!1}showDateFromMillis(e){return this.timezoneService.formatToString(e,this.tableTimezone,"ddd, DD MMM YYYY, hh:mm a")}getFeedbackSessions(){const e=this.filterTimezone,s=this.timezoneService.resolveLocalDateTime({year:this.startDate.year,month:this.startDate.month,day:this.startDate.day},{hour:this.startTime.hour,minute:this.startTime.minute},e),n=this.timezoneService.resolveLocalDateTime({year:this.endDate.year,month:this.endDate.month,day:this.endDate.day},{hour:this.endTime.hour,minute:this.endTime.minute},e),a="ddd, DD MMM YYYY, hh:mm a";this.startTimeString=this.timezoneService.formatToString(s,e,a),this.endTimeString=this.timezoneService.formatToString(n,e,a),this.timezoneString=this.filterTimezone,this.isLoadingOngoingSessions=!0,this.feedbackSessionsService.getOngoingSessions(s,n).pipe((0,S.j)(()=>{this.isLoadingOngoingSessions=!1})).subscribe({next:l=>{this.totalOngoingSessions=l.totalOngoingSessions,this.totalOpenSessions=l.totalOpenSessions,this.totalClosedSessions=l.totalClosedSessions,this.totalAwaitingSessions=l.totalAwaitingSessions,this.totalInstitutes=l.totalInstitutes,Object.keys(l.sessions).forEach(h=>{this.sessions[h]=l.sessions[h].map(v=>({ongoingSession:v,startTimeString:this.showDateFromMillis(v.startTime),endTimeString:this.showDateFromMillis(v.endTime)}))}),this.institutionPanelsStatus={};for(const h of Object.keys(l.sessions))this.institutionPanelsStatus[h]=!0},error:l=>{this.statusMessageService.showErrorToast(l.error.message)}})}getResponseRate(e,s,n,a){a&&(a.preventDefault(),a.stopPropagation()),this.feedbackSessionsService.loadSessionStatistics(s,n).subscribe({next:l=>{const h=this.sessions[e].filter(v=>v.ongoingSession.courseId===s&&v.ongoingSession.feedbackSessionName===n);h.length&&(h[0].responseRate=`${l.submittedTotal} / ${l.expectedTotal}`)},error:l=>{this.statusMessageService.showErrorToast(l.error.message)}})}updateDisplayedTimes(){for(const e of Object.values(this.sessions))for(const s of e)s.startTimeString=this.showDateFromMillis(s.ongoingSession.startTime),s.endTimeString=this.showDateFromMillis(s.ongoingSession.endTime)}static#t=this.\u0275fac=function(s){return new(s||i)(t.rXU(F.D),t.rXU(C.x),t.rXU(k.u))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["tm-admin-sessions-page"]],decls:21,vars:14,consts:[[1,"lead"],[1,"fas","fa-arrows-alt-h"],[1,"btn","btn-info","btn-sm","btn-margin-right",3,"click"],[1,"btn","btn-warning","btn-sm",3,"click"],[2,"margin-top","20px"],[1,"text-center"],["id","btn-toggle-filter",1,"btn","btn-link","center-block",3,"click"],["id","filter-section","class","card bg-light",4,"ngIf"],["noOngoingSessions",""],[4,"tmIsLoading"],["id","filter-section",1,"card","bg-light"],[1,"card-body"],[1,"row"],["data-toggle","tooltip","data-placement","top",1,"col-xl-4"],[1,"col-6"],[1,"label-control"],[1,"form-group"],[1,"input-group"],["id","start-date","placeholder","Date","name","dp1","ngbDatepicker","",1,"form-control",3,"ngModel","ngModelChange"],["dp1","ngbDatepicker"],["type","button",1,"btn","btn-light","input-group-text",3,"click"],[1,"fas","fa-calendar-alt"],[3,"ngModel","spinners","ngModelChange"],["data-toggle","tooltip","data-placement","top",1,"col-xl-4","border-left-gray"],["id","end-date","placeholder","Date","name","dp2","ngbDatepicker","",1,"form-control",3,"ngModel","ngModelChange"],["dp2","ngbDatepicker"],[1,"col-xl-4","border-left-gray"],[1,"col-12"],[1,"control-label"],["id","filter-timezone",1,"form-control","form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"col-6","d-grid"],["id","btn-get-sessions",1,"btn","btn-primary",3,"click"],[3,"value"],["role","alert",1,"alert","alert-warning","margin-top-30px"],[4,"ngIf","ngIfElse"],[1,"row","margin-top-30px",2,"align-items","center"],[1,"col-md-5"],[1,"col-md-7"],["aria-label","Timezone","id","table-timezone",1,"form-control","form-select",3,"ngModel","ngModelChange"],["class","card bg-light margin-top-30px",4,"ngFor","ngForOf"],[1,"card","bg-light","margin-top-30px"],[1,"text-white","card-header","bg-primary","cursor-pointer",3,"click"],[1,"card-header-btn-toolbar"],[3,"isExpanded"],["class","card-body session-table-body",4,"ngIf"],[1,"card-body","session-table-body"],[1,"table-responsive"],["id","ongoing-sessions-table",1,"table","table-striped","data-table","session-table"],[4,"ngFor","ngForOf"],[1,"text-break"],[4,"ngIf"],["target","_blank","rel","noopener noreferrer",3,"href"],["href","javascript:;",3,"click"]],template:function(s,n){1&s&&(t.j41(0,"span",0),t.EFF(1),t.nrm(2,"br"),t.EFF(3),t.nrm(4,"i",1),t.EFF(5),t.nrm(6,"br"),t.k0s(),t.j41(7,"button",2),t.bIt("click",function(){return n.openAllInstitutions()}),t.EFF(8,"Open All"),t.k0s(),t.j41(9,"button",3),t.bIt("click",function(){return n.closeAllInstitutions()}),t.EFF(10,"Collapse All"),t.k0s(),t.j41(11,"div",4)(12,"div",5)(13,"button",6),t.bIt("click",function(){return n.showFilter=!n.showFilter}),t.EFF(14),t.nrm(15,"br")(16,"i"),t.k0s()(),t.DNE(17,P,47,8,"div",7),t.k0s(),t.DNE(18,R,2,0,"ng-template",null,8,t.C5r),t.DNE(20,x,2,2,"div",9)),2&s&&(t.R7$(1),t.SjE(" Total: ",n.totalOngoingSessions," - Opened: ",n.totalOpenSessions," - Closed: ",n.totalClosedSessions," - Waiting To Open: ",n.totalAwaitingSessions," - Institutions: ",n.totalInstitutes," "),t.R7$(2),t.SpI(" ",n.startTimeString," \xa0 "),t.R7$(2),t.Lme(" \xa0 ",n.endTimeString," \xa0 ",n.timezoneString," "),t.R7$(9),t.SpI(" ",n.showFilter?"Hide":"Show"," filter "),t.R7$(2),t.ZvI("fas fa-chevron-",n.showFilter?"up":"down",""),t.R7$(1),t.Y8G("ngIf",n.showFilter),t.R7$(3),t.Y8G("tmIsLoading",n.isLoadingOngoingSessions))},dependencies:[r.Sq,r.bT,d.qT,d.xH,d.y7,d.me,d.wz,d.BC,d.cb,d.vS,d.cV,g.cw,g.Pe,j.n,E.F,r.lG],styles:["@media (width >= 1200px){.border-left-gray[_ngcontent-%COMP%]{border-left:1px solid rgba(0,0,0,.2)}}.margin-top-30px[_ngcontent-%COMP%]{margin-top:30px}.session-table-body[_ngcontent-%COMP%]{padding:0}.session-table[_ngcontent-%COMP%]{margin-bottom:0}"],data:{animation:[u.j]}})}return i})();var Y=o(84309),N=o(57125);const X=[{path:"",component:z}];let B=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.$C({type:i});static#n=this.\u0275inj=t.G2t({imports:[r.MD,d.YN,g.IQ,g.tJ,f.iI.forChild(X),Y.y,N.o]})}return i})()}}]);