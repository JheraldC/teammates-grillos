"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[8986],{57286:(v,m,s)=>{s.d(m,{y:()=>a});var l=s(17705);let a=(()=>{class r{constructor(){this.useBlueSpinner=!1,this.color="white"}static#i=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275cmp=l.VBU({type:r,selectors:[["tm-ajax-loading"]],inputs:{useBlueSpinner:"useBlueSpinner",color:"color"},decls:2,vars:3,consts:[[1,"loading-container"],["role","status"]],template:function(g,d){1&g&&(l.j41(0,"div",0),l.nrm(1,"div",1),l.k0s()),2&g&&(l.R7$(1),l.ZvI("spinner-border spinner-border-sm text-",d.useBlueSpinner?"primary":d.color,""))},styles:[".loading-container[_ngcontent-%COMP%]{display:inline;margin-right:10px}"]})}return r})()},28986:(v,m,s)=>{s.r(m),s.d(m,{LoginPageModule:()=>F});var l=s(60177),a=s(89417),r=s(82646),p=s(66338),u=s(85385),g=s(84309),d=s(75504),L=(s(17852),s(21076),s(8041),s(51362),s(70980)),f=s(11086),i=s(17705),_=s(72709),E=s(30715),I=s(57645),G=s(57286);const b=["captchaElem"];function x(e,c){1&e&&i.nrm(0,"tm-ajax-loading")}function j(e,c){if(1&e){const t=i.RV6();i.j41(0,"div")(1,"div",4)(2,"strong"),i.EFF(3,"Not Logged In"),i.k0s()(),i.j41(4,"div",5)(5,"div")(6,"button",6),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return i.Njj(o.logInWithGoogle())}),i.DNE(7,x,1,0,"tm-ajax-loading",3),i.EFF(8,"Log In with Google "),i.k0s()(),i.j41(9,"div",7)(10,"button",8),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return o.isLogInWithEmail=!0,i.Njj(o.isLoginPage=!1)}),i.EFF(11,"Log In with Email"),i.k0s()()()()}if(2&e){const t=i.XpG(2);i.R7$(6),i.Y8G("disabled",t.isLoggingInWithGoogle),i.R7$(1),i.Y8G("ngIf",t.isLoggingInWithGoogle)}}function S(e,c){if(1&e){const t=i.RV6();i.j41(0,"div",11),i.nrm(1,"div",16),i.j41(2,"div",13)(3,"ngx-recaptcha2",19,20),i.bIt("success",function(o){i.eBV(t);const h=i.XpG(3);return i.Njj(h.handleCaptchaSuccess(o))}),i.k0s()()()}if(2&e){const t=i.XpG(3);i.R7$(3),i.Y8G("siteKey",t.captchaSiteKey)("useGlobalDomain",!1)("size",t.size)("hl",t.lang)}}function P(e,c){1&e&&i.nrm(0,"tm-ajax-loading")}function k(e,c){if(1&e){const t=i.RV6();i.j41(0,"div")(1,"div",4)(2,"strong"),i.EFF(3,"Log In with Email"),i.k0s()(),i.j41(4,"div",9)(5,"form",10),i.bIt("ngSubmit",function(){i.eBV(t);const o=i.XpG(2);return i.Njj(o.logInWithEmail(o.formLogin))}),i.j41(6,"div",11)(7,"label",12)(8,"strong"),i.EFF(9,"Email:"),i.k0s()(),i.j41(10,"div",13),i.nrm(11,"input",14),i.k0s()(),i.DNE(12,S,5,4,"div",15),i.j41(13,"div",11),i.nrm(14,"div",16),i.j41(15,"div",13)(16,"button",17),i.DNE(17,P,1,0,"tm-ajax-loading",3),i.EFF(18,"Login "),i.k0s(),i.j41(19,"button",18),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return o.isLogInWithEmail=!1,i.Njj(o.isLoginPage=!0)}),i.EFF(20,"Cancel"),i.k0s()()()()()()}if(2&e){const t=i.XpG(2);i.R7$(5),i.Y8G("formGroup",t.formLogin),i.R7$(7),i.Y8G("ngIf",""!==t.captchaSiteKey),i.R7$(4),i.Y8G("disabled",t.isLoggingInWithEmail),i.R7$(1),i.Y8G("ngIf",t.isLoggingInWithEmail)}}function w(e,c){if(1&e){const t=i.RV6();i.j41(0,"div")(1,"div",4)(2,"strong"),i.EFF(3,"Login Email Sent"),i.k0s()(),i.j41(4,"div",9)(5,"p"),i.EFF(6),i.k0s(),i.j41(7,"a",21),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return o.isTroubleGettingEmail=!0,i.Njj(o.isLoginEmailSent=!1)}),i.EFF(8," Trouble getting email? "),i.k0s()()()}if(2&e){const t=i.XpG(2);i.R7$(6),i.SpI("An email with additional instructions has been sent to ",t.formLogin.controls.email.value,". Please check your email to complete the login process.")}}function T(e,c){if(1&e){const t=i.RV6();i.j41(0,"div")(1,"div",4)(2,"strong"),i.EFF(3,"Trouble Getting Email"),i.k0s()(),i.j41(4,"div",9)(5,"p"),i.EFF(6),i.k0s(),i.j41(7,"p",22),i.EFF(8,"If you haven't received this within a few minutes, it may have landed in your spam folder. Still having trouble? Try resending this email by clicking the resend button below."),i.k0s(),i.j41(9,"div")(10,"button",23),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return i.Njj(o.resendEmail())}),i.EFF(11,"Resend"),i.k0s(),i.j41(12,"button",18),i.bIt("click",function(){i.eBV(t);const o=i.XpG(2);return o.isTroubleGettingEmail=!1,i.Njj(o.isLoginEmailSent=!0)}),i.EFF(13,"Back"),i.k0s()()()()}if(2&e){const t=i.XpG(2);i.R7$(6),i.SpI("We have sent an email to ",t.formLogin.controls.email.value,".")}}function y(e,c){if(1&e&&(i.j41(0,"div",1)(1,"div",2),i.DNE(2,j,12,2,"div",3),i.DNE(3,k,21,4,"div",3),i.DNE(4,w,9,1,"div",3),i.DNE(5,T,14,1,"div",3),i.k0s()()),2&e){const t=i.XpG();i.R7$(2),i.Y8G("ngIf",t.isLoginPage),i.R7$(1),i.Y8G("ngIf",t.isLogInWithEmail),i.R7$(1),i.Y8G("ngIf",t.isLoginEmailSent),i.R7$(1),i.Y8G("ngIf",t.isTroubleGettingEmail)}}const C=[{path:"",component:(()=>{class e{constructor(t,n,o){this.authService=t,this.formBuilder=n,this.statusMessageService=o,this.captchaSuccess=!1,this.size="normal",this.lang="en",this.captchaSiteKey=f.c.captchaSiteKey,this.backendUrl=f.c.backendUrl,this.isLoginPage=!0,this.isLogInWithEmail=!1,this.isLoginEmailSent=!1,this.isTroubleGettingEmail=!1,this.isLoggingInWithGoogle=!1,this.isLoggingInWithEmail=!1,this.isPageLoading=!1}ngOnInit(){f.c.allowFirebaseLogin||(window.location.href="/"),this.isPageLoading=!0,this.formLogin=this.formBuilder.group({email:["",a.k0.required],recaptcha:[""]}),this.isLoggingInWithEmail=!0,this.isLoggingInWithGoogle=!0,this.handleGoogleRedirection(),this.handleEmailRedirection()}handleGoogleRedirection(){return this.authService.getRedirectResult().then(t=>{t.user?t.user.getIdToken().then(n=>{window.location.href=`${this.backendUrl}/oauth2callback${window.location.search}&idToken=${n}`}).catch(()=>{this.isPageLoading=!1,this.statusMessageService.showErrorToast("Login with Google is unsuccessful. Please try again.")}):(this.isLoggingInWithGoogle=!1,this.isPageLoading=this.isLoggingInWithEmail)}).catch(()=>{this.isPageLoading=!1,this.statusMessageService.showErrorToast("Login with Google is unsuccessful. Please try again.")})}handleEmailRedirection(){return this.authService.isLogInWithEmailLink(window.location.href).then(t=>{if(t){const n=window.localStorage.getItem("emailForSignIn");n?this.authService.logInWithEmailLink(n,window.location.href).then(o=>{window.localStorage.removeItem("emailForSignIn"),o.user.getIdToken().then(h=>{window.location.href=`${this.backendUrl}/oauth2callback${window.location.search}&idToken=${h}`}).catch(()=>{this.isPageLoading=!1,this.statusMessageService.showErrorToast("Login with email is unsuccessful. Please try again.")})}).catch(()=>{this.isPageLoading=!1,this.statusMessageService.showErrorToast("Login with email is unsuccessful. Please try again.")}):(this.isPageLoading=!1,this.statusMessageService.showErrorToast("Login link has already been used. If not, kindly login using the same device."))}else this.isLoggingInWithEmail=!1,this.isPageLoading=this.isLoggingInWithGoogle})}logInWithGoogle(){this.isLoggingInWithGoogle=!0;const t=new d.X;return t.addScope("https://www.googleapis.com/auth/userinfo.email"),this.authService.logInWithRedirect(t).then(()=>{this.isLoggingInWithGoogle=!1}).catch(()=>{this.isLoggingInWithGoogle=!1,this.statusMessageService.showErrorToast("Cannot redirect to Google login page. Please try again.")})}logInWithEmail(t){this.captchaSiteKey||(this.captchaResponse=""),this.formLogin.valid&&void 0!==this.captchaResponse?(this.isLoggingInWithEmail=!0,this.authService.sendLoginEmail({userEmail:t.controls.email.value,continueUrl:`${window.location.origin}/web/login${window.location.search}`,captchaResponse:this.captchaResponse}).pipe((0,L.j)(()=>{this.isLoggingInWithEmail=!1})).subscribe({next:n=>{n.isEmailSent?(window.localStorage.setItem("emailForSignIn",t.controls.email.value),this.isLoginEmailSent=!0,this.isLogInWithEmail=!1):(this.statusMessageService.showErrorToast(n.message),this.resetFormGroups())},error:n=>{this.statusMessageService.showErrorToast(n.error.message),this.resetFormGroups()}})):this.statusMessageService.showErrorToast("Please enter a valid email address and click the reCAPTCHA before submitting.")}resetFormGroups(){this.formLogin=this.formBuilder.group({email:["",a.k0.required],recaptcha:[""]}),this.reloadCaptcha()}reloadCaptcha(){this.captchaSiteKey&&this.captchaElem.reloadCaptcha()}handleCaptchaSuccess(t){this.captchaSuccess=!0,this.captchaResponse=t}resendEmail(){this.isLogInWithEmail=!0,this.isTroubleGettingEmail=!1}static#i=this.\u0275fac=function(n){return new(n||e)(i.rXU(_.u),i.rXU(a.ok),i.rXU(E.x))};static#t=this.\u0275cmp=i.VBU({type:e,selectors:[["tm-login-page"]],viewQuery:function(n,o){if(1&n&&i.GBs(b,5),2&n){let h;i.mGM(h=i.lsd())&&(o.captchaElem=h.first)}},decls:1,vars:1,consts:[["class","d-flex flex-column align-items-center",4,"tmIsLoading"],[1,"d-flex","flex-column","align-items-center"],[1,"card","bg-light",2,"width","500px"],[4,"ngIf"],[1,"card-header"],[1,"card-body","d-flex","flex-column","align-items-center"],[1,"btn","btn-light",2,"min-width","150px",3,"disabled","click"],[1,"mt-2"],[1,"btn","btn-danger",2,"min-width","150px",3,"click"],[1,"card-body"],[3,"formGroup","ngSubmit"],[1,"form-group","row"],[1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["type","email","formControlName","email","maxlength","254","email","true","spellcheck","false",1,"form-control"],["class","form-group row",4,"ngIf"],[1,"col-sm-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"btn","btn-light","ms-2",3,"click"],["formControlName","recaptcha",3,"siteKey","useGlobalDomain","size","hl","success"],["captchaElem",""],["href","#",2,"text-decoration","underline",3,"click"],[1,"mt-3"],[1,"btn","btn-primary",3,"click"]],template:function(n,o){1&n&&i.DNE(0,y,6,4,"div",0),2&n&&i.Y8G("tmIsLoading",o.isPageLoading)},dependencies:[l.bT,I.n,p.zM,a.qT,a.me,a.BC,a.cb,a.tU,a.Dg,a.j4,a.JD,G.y]})}return e})()}];let F=(()=>{class e{static#i=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=i.$C({type:e});static#e=this.\u0275inj=i.G2t({imports:[l.MD,r.iI.forChild(C),g.y,p.kd,a.X1,u.D]})}return e})()}}]);