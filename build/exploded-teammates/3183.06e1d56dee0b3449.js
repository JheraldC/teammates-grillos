"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[3183],{21036:(N,v,a)=>{a.d(v,{p:()=>_});var u=a(8059),S=a(17705),l=a(16507);let _=(()=>{class I{constructor(t){this.httpRequestService=t}loadInstructors(t){const n={courseid:t.courseId};return t.intent&&(n.intent=t.intent),this.httpRequestService.get(u.Ld.INSTRUCTORS,n)}getInstructor(t){const n={courseid:t.courseId,intent:t.intent};return t.feedbackSessionName&&(n.fsname=t.feedbackSessionName),t.key&&(n.key=t.key),t.moderatedPerson&&(n.moderatedperson=t.moderatedPerson),t.previewAs&&(n.previewas=t.previewAs),this.httpRequestService.get(u.Ld.INSTRUCTOR,n)}createInstructor(t){return this.httpRequestService.post(u.Ld.INSTRUCTOR,{courseid:t.courseId},t.requestBody)}updateInstructor(t){return this.httpRequestService.put(u.Ld.INSTRUCTOR,{courseid:t.courseId},t.requestBody)}deleteInstructor(t){const n={courseid:t.courseId};return t.instructorEmail&&(n.instructoremail=t.instructorEmail),t.instructorId&&(n.instructorid=t.instructorId),this.httpRequestService.delete(u.Ld.INSTRUCTOR,n)}loadInstructorPrivilege(t){const n={courseid:t.courseId};return t.instructorEmail&&(n.instructoremail=t.instructorEmail),t.instructorId&&(n.instructorid=t.instructorId),this.httpRequestService.get(u.Ld.INSTRUCTOR_PRIVILEGE,n)}updateInstructorPrivilege(t){return this.httpRequestService.put(u.Ld.INSTRUCTOR_PRIVILEGE,{courseid:t.courseId,instructoremail:t.instructorEmail},t.requestBody)}regenerateInstructorKey(t,n){return this.httpRequestService.post(u.Ld.INSTRUCTOR_KEY,{courseid:t,instructoremail:n})}static#e=this.\u0275fac=function(n){return new(n||I)(S.KVO(l.R))};static#t=this.\u0275prov=S.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}return I})()},87923:(N,v,a)=>{a.d(v,{_:()=>l});var u=a(17705),S=a(73629);let l=(()=>{class _{constructor(c){this.navigationService=c,this.URI_PREFIX="/web",this.JOIN_PAGE="/join",this.STUDENT_HOME_PAGE="/student/home",this.INSTRUCTOR_HOME_PAGE="/instructor/home",this.ADMIN_ACCOUNTS_PAGE="/admin/accounts",this.INSTRUCTOR_STUDENT_PROFILE_PAGE="/instructor/courses/student/details",this.SESSIONS_SUBMISSION_PAGE="/sessions/submission",this.SESSIONS_RESULT_PAGE="/sessions/result"}generateCourseJoinLink(c,t){const n=window.location.origin,p={key:c.key||"",entitytype:t};this.filterEmptyParams(p);const f=this.navigationService.encodeParams(p);return`${n}${this.URI_PREFIX}${this.JOIN_PAGE}${f}`}generateAccountRegistrationLink(c){const t=window.location.origin,m=this.navigationService.encodeParams({iscreatingaccount:"true",key:c});return`${t}${this.URI_PREFIX}${this.JOIN_PAGE}${m}`}generateHomePageLink(c,t){const n={user:c};this.filterEmptyParams(n);const m=this.navigationService.encodeParams(n);return`${this.URI_PREFIX}${t}${m}`}generateManageAccountLink(c,t){const n={instructorid:c};this.filterEmptyParams(n);const m=this.navigationService.encodeParams(n);return`${this.URI_PREFIX}${t}${m}`}generateProfilePageLink(c,t){const{courseId:n,email:m}=c,p={courseid:n,studentemail:m,user:t};this.filterEmptyParams(p);const f=this.navigationService.encodeParams(p);return`${this.URI_PREFIX}${this.INSTRUCTOR_STUDENT_PROFILE_PAGE}${f}`}generateSubmitUrl(c,t,n){const m=window.location.origin,E={key:c.key||"",fsname:t,courseid:c.courseId};n&&(E.entitytype="instructor"),this.filterEmptyParams(E);const P=this.navigationService.encodeParams(E);return`${m}${this.URI_PREFIX}${this.SESSIONS_SUBMISSION_PAGE}${P}`}generateResultUrl(c,t,n){const m=window.location.origin,E={key:c.key||"",fsname:t,courseid:c.courseId};n&&(E.entitytype="instructor"),this.filterEmptyParams(E);const P=this.navigationService.encodeParams(E);return`${m}${this.URI_PREFIX}${this.SESSIONS_RESULT_PAGE}${P}`}filterEmptyParams(c){Object.keys(c).forEach(t=>{""===c[t]&&delete c[t]})}static#e=this.\u0275fac=function(t){return new(t||_)(u.KVO(S.o))};static#t=this.\u0275prov=u.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},93183:(N,v,a)=>{a.d(v,{S:()=>K});var u=a(27468),S=a(7673),l=a(96354),_=a(73028),I=a(8059),c=a(40035),t=a(94089),n=a(17705),m=a(21036),p=a(16507),f=a(43743),E=a(89734),P=a(87923),F=a(50833);let K=(()=>{class O{constructor(s,e,r,i,o,d){this.instructorService=s,this.httpRequestService=e,this.feedbackSessionService=r,this.courseService=i,this.linkService=o,this.timezoneService=d}searchInstructor(s){return this.searchStudents(s,"instructor").pipe((0,l.T)(e=>({students:e.students,comments:[]})))}searchAdmin(s){return(0,u.p)([this.searchStudents(s,"admin"),this.searchInstructors(s),this.searchAccountRequests(s)]).pipe((0,l.T)(e=>[e[0].students,e[1].instructors,e[2].accountRequests]),(0,_.Z)(e=>{const[r,i,o]=e;return(0,u.p)([(0,S.of)(r),(0,S.of)(i),(0,S.of)(o),this.getDistinctFields(r,i)])}),(0,l.T)(e=>({students:this.createStudentAccountSearchResults(e[0],...e[3]),instructors:this.createInstructorAccountSearchResults(e[1],e[3][1],e[3][2]),accountRequests:this.createAccountRequestSearchResults(e[2])})))}searchStudents(s,e){return this.httpRequestService.get(I.Ld.SEARCH_STUDENTS,{searchkey:s,entitytype:e})}searchInstructors(s){return this.httpRequestService.get(I.Ld.SEARCH_INSTRUCTORS,{searchkey:s})}searchAccountRequests(s){return this.httpRequestService.get(I.Ld.SEARCH_ACCOUNT_REQUESTS,{searchkey:s})}createStudentAccountSearchResults(s,e,r,i,o){return s.map(d=>{const{courseId:h}=d;return this.joinAdminStudent(d,e[h],r[h],i[h],o[h])})}joinAdminStudent(s,e,r,i,o){let d={email:"",name:"",comments:"",team:"",section:"",awaitingSessions:{},openSessions:{},notOpenSessions:{},publishedSessions:{},courseId:"",courseName:"",isCourseDeleted:!1,institute:"",manageAccountLink:"",homePageLink:"",profilePageLink:"",courseJoinLink:"",googleId:"",showLinks:!1};const{email:h,name:k,comments:A="",teamName:T,sectionName:L,googleId:g="",institute:D=""}=s;d={...d,email:h,name:k,comments:A,team:T,section:L,googleId:g,institute:D};const{courseId:M,courseName:C,deletionTimestamp:B}=r;d={...d,courseId:M,courseName:C,isCourseDeleted:!!B};let U="";for(const R of e.instructors)if(R.googleId&&R.role===c.vD.INSTRUCTOR_PERMISSION_ROLE_COOWNER){U=R.googleId;break}if(""===U)for(const R of e.instructors){const b=o.shift();if(R.googleId&&b&&b.privileges.courseLevel.canModifyInstructor){U=R.googleId;break}}const{awaitingSessions:$,openSessions:y,notOpenSessions:W,publishedSessions:G}=this.classifyFeedbackSessions(i,s,!1);return d={...d,awaitingSessions:$,openSessions:y,notOpenSessions:W,publishedSessions:G},d.courseJoinLink=this.linkService.generateCourseJoinLink(s,"student"),d.homePageLink=this.linkService.generateHomePageLink(g,this.linkService.STUDENT_HOME_PAGE),d.profilePageLink=this.linkService.generateProfilePageLink(s,U),d.manageAccountLink=this.linkService.generateManageAccountLink(g,this.linkService.ADMIN_ACCOUNTS_PAGE),d}createInstructorAccountSearchResults(s,e,r){return s.map(i=>this.joinAdminInstructor(i,e[i.courseId],r[i.courseId]))}joinAdminInstructor(s,e,r){let i={email:"",name:"",courseId:"",courseName:"",isCourseDeleted:!1,institute:"",manageAccountLink:"",homePageLink:"",courseJoinLink:"",googleId:"",showLinks:!1,awaitingSessions:{},openSessions:{},notOpenSessions:{},publishedSessions:{}};const{email:o,name:d,googleId:h="",institute:k=""}=s;i={...i,email:o,name:d,googleId:h,institute:k};const{courseId:A,courseName:T,deletionTimestamp:L}=e;i={...i,courseId:A,courseName:T,isCourseDeleted:!!L};const{awaitingSessions:g,openSessions:D,notOpenSessions:M,publishedSessions:C}=this.classifyFeedbackSessions(r,s,!0);return i={...i,awaitingSessions:g,openSessions:D,notOpenSessions:M,publishedSessions:C},i.courseJoinLink=this.linkService.generateCourseJoinLink(s,"instructor"),i.homePageLink=this.linkService.generateHomePageLink(h,this.linkService.INSTRUCTOR_HOME_PAGE),i.manageAccountLink=this.linkService.generateManageAccountLink(h,this.linkService.ADMIN_ACCOUNTS_PAGE),i}classifyFeedbackSessions(s,e,r){const i={awaitingSessions:{},openSessions:{},notOpenSessions:{},publishedSessions:{}};for(const o of s.feedbackSessions)this.feedbackSessionService.isFeedbackSessionOpen(o)?i.openSessions[o.feedbackSessionName]={...this.formatProperties(o),feedbackSessionUrl:this.linkService.generateSubmitUrl(e,o.feedbackSessionName,r)}:this.feedbackSessionService.isFeedbackSessionAwaiting(o)?i.awaitingSessions[o.feedbackSessionName]={...this.formatProperties(o),feedbackSessionUrl:this.linkService.generateSubmitUrl(e,o.feedbackSessionName,r)}:i.notOpenSessions[o.feedbackSessionName]={...this.formatProperties(o),feedbackSessionUrl:this.linkService.generateSubmitUrl(e,o.feedbackSessionName,r)},this.feedbackSessionService.isFeedbackSessionPublished(o)&&(i.publishedSessions[o.feedbackSessionName]={...this.formatProperties(o),feedbackSessionUrl:this.linkService.generateResultUrl(e,o.feedbackSessionName,r)});return i}createAccountRequestSearchResults(s){return s.map(e=>this.joinAdminAccountRequest(e))}joinAdminAccountRequest(s){let e={id:"",name:"",email:"",institute:"",createdAtText:"",registeredAtText:"",registrationLink:"",showLinks:!1,status:c.VD.PENDING,comments:""};const{id:r,registrationKey:i,createdAt:o,registeredAt:d,name:h,institute:k,email:A,status:T,comments:L}=s,g=this.timezoneService.guessTimezone()||"UTC";e.createdAtText=this.formatTimestampAsString(o,g),e.registeredAtText=d?this.formatTimestampAsString(d,g):null,e.comments=L||"";const D=this.linkService.generateAccountRegistrationLink(i);return e={...e,id:r,name:h,email:A,institute:k,registrationLink:D,status:T},e}getDistinctFields(s,e){const r=Array.from(new Set([...s.map(i=>i.courseId),...e.map(i=>i.courseId)]));return 0===r.length?(0,u.p)([(0,S.of)({}),(0,S.of)({}),(0,S.of)({}),(0,S.of)({})]):(0,u.p)([this.getDistinctInstructors(r),this.getDistinctCourses(r),this.getDistinctFeedbackSessions(r)]).pipe((0,_.Z)(i=>(0,u.p)([(0,S.of)(i[0]),(0,S.of)(i[1]),(0,S.of)(i[2]),this.getDistinctInstructorPrivileges(i[0])])))}getDistinctInstructors(s){return(0,u.p)(s.map(e=>this.instructorService.loadInstructors({courseId:e,intent:t.JD.FULL_DETAIL}))).pipe((0,l.T)(e=>{const r={};return e.forEach((i,o)=>{r[s[o]]=i}),r}))}getDistinctInstructorPrivileges(s){const e=Object.keys(s),r=Object.values(s);return(0,u.p)([(0,S.of)(e),(0,u.p)(r.map(i=>(0,u.p)(i.instructors.map(o=>this.instructorService.loadInstructorPrivilege({courseId:o.courseId,instructorEmail:o.email})))))]).pipe((0,l.T)(i=>{const o={};return i[1].forEach((d,h)=>{o[i[0][h]]=d}),o}))}getDistinctCourses(s){return(0,u.p)(s.map(e=>this.courseService.getCourseAsInstructor(e))).pipe((0,l.T)(e=>{const r={};return e.forEach((i,o)=>{r[s[o]]=i}),r}))}getDistinctFeedbackSessions(s){return(0,u.p)(s.map(e=>this.feedbackSessionService.getFeedbackSessionsForStudent("admin",e))).pipe((0,l.T)(e=>{const r={};return e.forEach((i,o)=>{r[s[o]]=i}),r}))}formatProperties(s){return{startTime:this.formatTimestampAsString(s.submissionStartTimestamp,s.timeZone),endTime:this.formatTimestampAsString(s.submissionEndTimestamp,s.timeZone)}}formatTimestampAsString(s,e){return this.timezoneService.formatToString(s,e,"ddd, DD MMM YYYY, hh:mm A Z")}static#e=this.\u0275fac=function(e){return new(e||O)(n.KVO(m.p),n.KVO(p.R),n.KVO(f.u),n.KVO(E.f),n.KVO(P._),n.KVO(F.D))};static#t=this.\u0275prov=n.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})()}}]);