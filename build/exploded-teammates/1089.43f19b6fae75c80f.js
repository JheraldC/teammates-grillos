"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[1089],{11089:(Be,g,r)=>{r.r(g),r.d(g,{InstructorSessionsPageModule:()=>Fe});var h=r(60177),m=r(89417),_=r(82646),F=r(96508),E=r.n(F),y=r(7673),v=r(27468),c=r(70980),R=r(70274),M=r(47710),e=r(17705),S=r(94227);function T(i,l){if(1&i&&(e.j41(0,"option",19),e.EFF(1),e.k0s()),2&i){const s=l.$implicit;e.Y8G("ngValue",s.courseId),e.R7$(1),e.JRh(s.courseId)}}function k(i,l){if(1&i){const s=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",20),e.bIt("ngModelChange",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.copyFromFeedbackSession=o)}),e.k0s()(),e.j41(3,"td",21),e.EFF(4),e.k0s(),e.j41(5,"td",21),e.EFF(6),e.k0s()()}if(2&i){const s=l.$implicit,n=e.XpG();e.R7$(2),e.Y8G("ngModel",n.copyFromFeedbackSession)("value",s),e.R7$(2),e.JRh(s.courseId),e.R7$(2),e.JRh(s.feedbackSessionName)}}let C=(()=>{class i{constructor(s){this.activeModal=s,this.FEEDBACK_SESSION_NAME_MAX_LENGTH=M.P3,this.courseCandidates=[],this.existingFeedbackSession=[],this.copyToCourseId="",this.newFeedbackSessionName=""}copy(){this.activeModal.close({fromFeedbackSession:this.copyFromFeedbackSession,newFeedbackSessionName:this.newFeedbackSessionName,copyToCourseId:this.copyToCourseId})}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(S.Lw))};static#s=this.\u0275cmp=e.VBU({type:i,selectors:[["tm-copy-from-other-sessions-modal"]],inputs:{courseCandidates:"courseCandidates",existingFeedbackSession:"existingFeedbackSession"},decls:42,vars:7,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-12"],[1,"form-group"],["id","copy-course-id",1,"form-control","form-select",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["id","copy-session-name","type","text","maxlength","38","placeholder","e.g. Feedback for Project Presentation 1","required","",1,"form-control",3,"ngModel","ngModelChange"],["newSessionName","ngModel"],[1,"invalid-field",3,"hidden"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],["id","copy-selection-table",1,"table-responsive-lg","table","table-bordered","table-hover"],[1,"bg-primary","text-white"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[3,"ngValue"],["type","radio","name","copySessionFrom",3,"ngModel","value","ngModelChange"],[1,"text-break"]],template:function(n,o){if(1&n&&(e.j41(0,"div",0)(1,"h5",1),e.EFF(2,"Creating a new session by copying a previous session"),e.k0s(),e.j41(3,"button",2),e.bIt("click",function(){return o.activeModal.dismiss()}),e.k0s()(),e.j41(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"label"),e.EFF(9,"Create in course"),e.k0s(),e.j41(10,"select",7),e.bIt("ngModelChange",function(d){return o.copyToCourseId=d}),e.DNE(11,T,2,2,"option",8),e.k0s()(),e.j41(12,"div",6)(13,"label")(14,"b"),e.EFF(15,"Name for new session*"),e.k0s()(),e.j41(16,"input",9,10),e.bIt("ngModelChange",function(d){return o.newFeedbackSessionName=d}),e.k0s(),e.j41(18,"div",11),e.nrm(19,"i",12),e.EFF(20,' The field "Name for new session" should not be empty. '),e.k0s(),e.j41(21,"span"),e.EFF(22),e.k0s()(),e.j41(23,"div",6)(24,"label")(25,"b"),e.EFF(26,"Copy settings and questions from"),e.k0s()(),e.j41(27,"table",13)(28,"thead",14)(29,"tr")(30,"th"),e.EFF(31,"\xa0"),e.k0s(),e.j41(32,"th"),e.EFF(33,"Course ID"),e.k0s(),e.j41(34,"th"),e.EFF(35,"Feedback Session Name"),e.k0s()()(),e.DNE(36,k,7,4,"tr",15),e.k0s()()()()(),e.j41(37,"div",16)(38,"button",17),e.bIt("click",function(){return o.copy()}),e.EFF(39,"Copy"),e.k0s(),e.j41(40,"button",18),e.bIt("click",function(){return o.activeModal.dismiss()}),e.EFF(41,"Cancel"),e.k0s()()),2&n){const t=e.sdS(17);e.R7$(10),e.Y8G("ngModel",o.copyToCourseId),e.R7$(1),e.Y8G("ngForOf",o.courseCandidates),e.R7$(5),e.Y8G("ngModel",o.newFeedbackSessionName),e.R7$(2),e.Y8G("hidden",t.valid||t.pristine&&t.untouched),e.R7$(4),e.SpI("",o.FEEDBACK_SESSION_NAME_MAX_LENGTH-o.newFeedbackSessionName.length," characters left"),e.R7$(14),e.Y8G("ngForOf",o.existingFeedbackSession),e.R7$(2),e.Y8G("disabled",!o.copyFromFeedbackSession||!o.copyToCourseId||!o.newFeedbackSessionName)}},dependencies:[h.Sq,m.xH,m.y7,m.me,m.wz,m.Fm,m.BC,m.YS,m.tU,m.vS],styles:[".invalid-field[_ngcontent-%COMP%]{padding-top:5px;color:#b50000}"]})}return i})(),I=(()=>{class i{constructor(s){this.activeModal=s,this.courseId="",this.feedbackSessionName=""}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(S.Lw))};static#s=this.\u0275cmp=e.VBU({type:i,selectors:[["tm-session-permanent-deletion-confirm-modal"]],inputs:{courseId:"courseId",feedbackSessionName:"feedbackSessionName"},decls:12,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"h5",1),e.nrm(2,"i",2),e.EFF(3," Confirm deleting feedback session"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return o.activeModal.dismiss()}),e.k0s()(),e.j41(5,"div",4),e.EFF(6),e.k0s(),e.j41(7,"div",5)(8,"button",6),e.bIt("click",function(){return o.activeModal.dismiss()}),e.EFF(9,"No, Cancel the Operation"),e.k0s(),e.j41(10,"button",7),e.bIt("click",function(){return o.activeModal.close()}),e.EFF(11,"Yes"),e.k0s()()),2&n&&(e.R7$(6),e.Lme(" Are you sure you want to permanently delete the feedback session ",o.feedbackSessionName," in ",o.courseId,"?\n"))}})}return i})();function B(i,l){if(1&i&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&i){const s=l.$implicit;e.R7$(1),e.Lme("",s.courseId,": ",s.feedbackSessionName,"")}}let w=(()=>{class i{constructor(s){this.activeModal=s,this.sessionsToDelete=[]}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(S.Lw))};static#s=this.\u0275cmp=e.VBU({type:i,selectors:[["tm-sessions-permanent-deletion-confirm-modal"]],inputs:{sessionsToDelete:"sessionsToDelete"},decls:18,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"h5",1),e.nrm(2,"i",2),e.EFF(3," Confirm deleting all feedback sessions in the Recycle Bin"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return o.activeModal.dismiss()}),e.k0s()(),e.j41(5,"div",4)(6,"div"),e.EFF(7),e.j41(8,"b"),e.EFF(9,"Recycle Bin"),e.k0s(),e.EFF(10,"? "),e.k0s(),e.j41(11,"ul"),e.DNE(12,B,2,2,"li",5),e.k0s()(),e.j41(13,"div",6)(14,"button",7),e.bIt("click",function(){return o.activeModal.dismiss()}),e.EFF(15,"No, Cancel the Operation"),e.k0s(),e.j41(16,"button",8),e.bIt("click",function(){return o.activeModal.close()}),e.EFF(17,"Yes"),e.k0s()()),2&n&&(e.R7$(7),e.SpI(" Are you sure you want to permanently delete the following ",o.sessionsToDelete.length," feedback sessions in the "),e.R7$(5),e.Y8G("ngForOf",o.sessionsToDelete))},dependencies:[h.Sq]})}return i})();var f=r(40035),b=r(64180),u=r(26195),N=r(34891),j=r(35725),L=r(21894),D=r(7730),P=r(44199),O=r(42455),G=r(30715),x=r(73629),A=r(43743),V=r(26412),X=r(86978),Y=r(21036),U=r(16),$=r(6294),H=r(58240),z=r(31571),Z=r(50833),W=r(89734),Q=r(36122),J=r(44187),K=r(74597),q=r(57645),ee=r(72890),se=r(53992),oe=r(92042);const ne=["modifiedTimestampsModal"];function te(i,l){1&i&&(e.j41(0,"div",11),e.EFF(1," You have not created any courses yet, or you have no active courses. Go "),e.j41(2,"a",12),e.EFF(3,"here"),e.k0s(),e.EFF(4," to create or unarchive a course.\n"),e.k0s())}function ie(i,l){if(1&i){const s=e.RV6();e.j41(0,"div",13)(1,"div")(2,"tm-session-edit-form",14),e.bIt("modelChange",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.sessionEditFormModel=o)})("modelChange",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.triggerModelChange(o))})("addNewSessionEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.addNewSessionHandler())})("copyOtherSessionsEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.copyFromOtherSessionsHandler())})("closeEditFormEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.isSessionEditFormExpanded=!1)}),e.k0s()()()}if(2&i){const s=e.XpG();e.Y8G("@collapseAnim",void 0),e.R7$(2),e.Y8G("formMode",s.SessionEditFormMode.ADD)("model",s.sessionEditFormModel)("courseCandidates",s.courseCandidates)("templateSessions",s.templateSessions)("isCopyOtherSessionLoading",s.isCopyOtherSessionLoading)}}function re(i,l){1&i&&(e.j41(0,"div",18),e.EFF(1," You have not created any sessions yet. Use the form above to create a session. "),e.k0s())}const ae=function(i){return[i]};function de(i,l){if(1&i){const s=e.RV6();e.j41(0,"tm-sessions-table",19),e.bIt("sortSessionsTableRowModelsEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.sortSessionsTableRowModelsEvent(o))})("loadResponseRateEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.loadResponseRateEventHandler(o))})("moveSessionToRecycleBinEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.moveSessionToRecycleBinEventHandler(o))})("copySessionEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.copySessionEventHandler(o))})("submitSessionAsInstructorEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.submitSessionAsInstructorEventHandler(o))})("publishSessionEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.publishSessionEventHandler(o))})("unpublishSessionEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.unpublishSessionEventHandler(o))})("downloadSessionResultsEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.downloadSessionResultEventHandler(o))})("resendResultsLinkToStudentsEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.resendResultsLinkToRespondentsEventHandler(t.sessionsTableRowModels[o]))})("sendRemindersToAllNonSubmittersEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.sendRemindersToRespondentsEventHandler(t.sessionsTableRowModels[o],!0))})("sendRemindersToSelectedNonSubmittersEvent",function(o){e.eBV(s);const t=e.XpG(2);return e.Njj(t.sendRemindersToRespondentsEventHandler(t.sessionsTableRowModels[o],!1))}),e.k0s()}if(2&i){const s=e.XpG(2);e.Y8G("sessionsTableRowModels",s.sessionsTableRowModels)("courseCandidates",s.courseCandidates)("columnsToShow",e.eq3(5,ae,s.SessionsTableColumn.COURSE_ID))("headerColorScheme",s.SortableTableHeaderColorScheme.BLUE)("isSendReminderLoading",s.isSendReminderLoading)}}function le(i,l){if(1&i&&(e.j41(0,"div",15),e.DNE(1,re,2,0,"div",16),e.DNE(2,de,1,7,"tm-sessions-table",17),e.k0s()),2&i){const s=e.XpG();e.R7$(1),e.Y8G("ngIf",0===s.sessionsTableRowModels.length&&!s.isFeedbackSessionsLoading),e.R7$(1),e.Y8G("tmIsLoading",s.isFeedbackSessionsLoading)}}function ce(i,l){if(1&i){const s=e.RV6();e.j41(0,"tm-sessions-recycle-bin-table",20),e.bIt("restoreSessionEvent",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.restoreRecycleBinFeedbackSession(o))})("restoreAllRecycleBinFeedbackSessionEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.restoreAllRecycleBinFeedbackSession())})("permanentlyDeleteSessionEvent",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.permanentDeleteSession(o))})("permanentDeleteAllSessionsEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.permanentDeleteAllSessions())})("sortRecycleBinFeedbackSessionRowsEvent",function(o){e.eBV(s);const t=e.XpG();return e.Njj(t.sortRecycleBinFeedbackSessionRowsEvent(o))})("recycleBinExpandEvent",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.isRecycleBinExpanded=!o.isRecycleBinExpanded)}),e.k0s()}if(2&i){const s=e.XpG();e.Y8G("isRecycleBinExpanded",s.isRecycleBinExpanded)("recycleBinFeedbackSessionRowModels",s.recycleBinFeedbackSessionRowModels)("recycleBinFeedbackSessionRowModelsSortBy",s.recycleBinFeedbackSessionRowModelsSortBy)("recycleBinFeedbackSessionRowModelsSortOrder",s.recycleBinFeedbackSessionRowModelsSortOrder)("isPermanentDeleteLoading",s.isPermanentDeleteLoading)}}function me(i,l){if(1&i&&e.nrm(0,"tm-modified-timestamps-modal",21),2&i){const s=e.XpG();e.Y8G("coursesOfModifiedSession",s.coursesOfModifiedSession)("modifiedSessions",s.modifiedSession)}}let ue=(()=>{class i extends O.t{constructor(s,n,o,t,d,p,a,ye,Re,Me,Te,ke,Ce,Ie){super(a,s,n,o,t,ye,d,Re,Me,Te,ke,p),this.courseService=Ce,this.route=Ie,this.SortBy=u.g,this.SortOrder=u.x,this.SessionEditFormMode=N.o,this.SessionsTableColumn=j.i,this.SortableTableHeaderColorScheme=D.u,this.courseId="",this.courseCandidates=[],this.templateSessions=[],this.isSessionEditFormExpanded=!1,this.sessionsTableRowModels=[],this.isRecycleBinExpanded=!1,this.recycleBinFeedbackSessionRowModels=[],this.recycleBinFeedbackSessionRowModelsSortBy=u.g.NONE,this.recycleBinFeedbackSessionRowModelsSortOrder=u.x.ASC,this.isCopyOtherSessionLoading=!1,this.isCoursesLoading=!0,this.isFeedbackSessionsLoading=!0,this.isMoveToRecycleBinLoading=!1,this.isCopySessionLoading=!1,this.isRecycleBinLoading=!0,this.isRestoreFeedbackSessionLoading=!1,this.isPermanentDeleteLoading=!1,this.hasCourseLoadingFailed=!1,this.hasFeedbackSessionLoadingFailed=!1,this.sessionEditFormModel={...this.sessionEditFormModel,isEditable:!0,gracePeriod:15,responseVisibleSetting:f.KG.LATER,instructions:"Please answer all the given questions."}}ngOnInit(){this.route.queryParams.subscribe(s=>{this.courseId=s.courseid}),this.isSessionEditFormExpanded=!!this.courseId,this.templateSessions=this.feedbackSessionsService.getTemplateSessions(),this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}copyFromOtherSessionsHandler(){this.isCopyOtherSessionLoading=!0;const s=this.ngbModal.open(C);s.componentInstance.copyToCourseId=this.sessionEditFormModel.courseId,s.componentInstance.courseCandidates=this.courseCandidates,s.componentInstance.existingFeedbackSession=this.sessionsTableRowModels.map(n=>n.feedbackSession),s.result.then(n=>{this.coursesOfModifiedSession=[],this.modifiedSession={},this.copyFeedbackSession(n.fromFeedbackSession,n.newFeedbackSessionName,n.copyToCourseId,n.fromFeedbackSession.courseId).pipe((0,c.j)(()=>{this.isCopyOtherSessionLoading=!1})).subscribe({next:o=>{this.coursesOfModifiedSession.length>0?this.simpleModalService.openInformationModal("Note On Tweaked Session Timestamps",L.i.WARNING,this.modifiedTimestampsModal,{onClosed:()=>this.navigationService.navigateByURLWithParamEncoding("/web/instructor/sessions/edit",{courseid:o.courseId,fsname:o.feedbackSessionName})}):this.navigationService.navigateWithSuccessMessage("/web/instructor/sessions/edit","The feedback session has been copied. Please modify settings/questions as necessary.",{courseid:o.courseId,fsname:o.feedbackSessionName})},error:o=>{this.statusMessageService.showErrorToast(this.formatErrorMessage(o.error.message))}})}).catch(()=>{this.isCopyOtherSessionLoading=!1})}loadCandidatesCourse(){this.isCoursesLoading=!0,this.courseService.getInstructorCoursesThatAreActive().pipe((0,c.j)(()=>{this.isCoursesLoading=!1})).subscribe({next:s=>{this.courseCandidates=s.courses,this.initDefaultValuesForSessionEditForm()},error:s=>{this.resetAllModels(),this.hasCourseLoadingFailed=!0,this.statusMessageService.showErrorToast(s.error.message)}})}initDefaultValuesForSessionEditForm(){const s=this.courseCandidates.find(t=>t.courseId===this.courseId);s?(this.sessionEditFormModel.courseId=s.courseId,this.sessionEditFormModel.courseName=s.courseName,this.sessionEditFormModel.timeZone=s.timeZone):0!==this.courseCandidates.length&&(this.sessionEditFormModel.courseId=this.courseCandidates[0].courseId,this.sessionEditFormModel.courseName=this.courseCandidates[0].courseName,this.sessionEditFormModel.timeZone=this.courseCandidates[0].timeZone),0!==this.templateSessions.length&&(this.sessionEditFormModel.templateSessionName=this.templateSessions[0].name);const n=E()().tz(this.sessionEditFormModel.timeZone).add(1,"hours");this.sessionEditFormModel.submissionStartDate={year:n.year(),month:n.month()+1,day:n.date()},this.sessionEditFormModel.submissionStartTime={minute:0===n.hour()?59:0,hour:0===n.hour()?23:n.hour()};const o=E()().tz(this.sessionEditFormModel.timeZone).add(1,"days");this.sessionEditFormModel.submissionEndDate={year:o.year(),month:o.month()+1,day:o.date()},this.sessionEditFormModel.submissionEndTime={minute:59,hour:23}}addNewSessionHandler(){this.sessionEditFormModel.isSaving=!0;const s=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,!0),n=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,!0);let o=0;this.sessionEditFormModel.sessionVisibleSetting===f.Be.CUSTOM&&(o=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,!0));let t=0;this.sessionEditFormModel.responseVisibleSetting===f.KG.CUSTOM&&(t=this.timezoneService.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,!0)),this.feedbackSessionsService.createFeedbackSession(this.sessionEditFormModel.courseId,{feedbackSessionName:this.sessionEditFormModel.feedbackSessionName,instructions:this.sessionEditFormModel.instructions,submissionStartTimestamp:s,submissionEndTimestamp:n,gracePeriod:this.sessionEditFormModel.gracePeriod,sessionVisibleSetting:this.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:o,responseVisibleSetting:this.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:t,isClosingSoonEmailEnabled:this.sessionEditFormModel.isClosingSoonEmailEnabled,isPublishedEmailEnabled:this.sessionEditFormModel.isPublishedEmailEnabled}).subscribe({next:d=>{const p=this.feedbackSessionsService.getTemplateSessions().find(a=>a.name===this.sessionEditFormModel.templateSessionName);p&&(0,y.of)(...p.questions).pipe((0,R.H)(a=>this.feedbackQuestionsService.createFeedbackQuestion(d.courseId,d.feedbackSessionName,{questionNumber:a.questionNumber,questionBrief:a.questionBrief,questionDescription:a.questionDescription,questionDetails:a.questionDetails,questionType:a.questionType,giverType:a.giverType,recipientType:a.recipientType,numberOfEntitiesToGiveFeedbackToSetting:a.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:a.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:a.showResponsesTo,showGiverNameTo:a.showGiverNameTo,showRecipientNameTo:a.showRecipientNameTo}))).subscribe({next:()=>{},error:a=>{this.sessionEditFormModel.isSaving=!1,this.statusMessageService.showErrorToast(`The session is created but the template questions cannot be created: ${a.error.message}`)},complete:()=>{this.navigationService.navigateByURLWithParamEncoding("/web/instructor/sessions/edit",{courseid:d.courseId,fsname:d.feedbackSessionName}).then(()=>{this.statusMessageService.showSuccessToast('The feedback session has been added.Click the "Add New Question" button below to begin adding questions for the feedback session.')})}})},error:d=>{this.sessionEditFormModel.isSaving=!1,this.statusMessageService.showErrorToast(this.formatErrorMessage(d.error.message))}})}formatErrorMessage(s){return s.match("exists already in the course")?`${s}\n          Tip: If you can't find such a session in that course, also check the 'Recycle bin'\n          (shown at the bottom of the 'Sessions' page).`:s}loadFeedbackSessions(){this.isFeedbackSessionsLoading=!0,this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe((0,c.j)(()=>{this.isFeedbackSessionsLoading=!1})).subscribe({next:s=>{s.feedbackSessions.forEach(n=>{const o={feedbackSession:n,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:n.privileges||(0,b.Ws)()};this.sessionsTableRowModels.push(o)})},error:s=>{this.resetAllModels(),this.hasFeedbackSessionLoadingFailed=!0,this.statusMessageService.showErrorToast(s.error.message)}})}sortSessionsTableRowModelsEvent(s){this.sessionsTableRowModels.sort(this.sortModelsBy(s.sortBy,s.sortOrder))}sortRecycleBinFeedbackSessionRowsEvent(s){this.recycleBinFeedbackSessionRowModelsSortBy=s,this.recycleBinFeedbackSessionRowModelsSortOrder=this.recycleBinFeedbackSessionRowModelsSortOrder===u.x.DESC?u.x.ASC:u.x.DESC,this.recycleBinFeedbackSessionRowModels.sort(this.sortModelsBy(s,this.recycleBinFeedbackSessionRowModelsSortOrder))}loadResponseRateEventHandler(s){this.loadResponseRate(n=>{this.sessionsTableRowModels=[...n]},this.sessionsTableRowModels,s)}restoreRecycleBinFeedbackSession(s){this.isRestoreFeedbackSessionLoading=!0,this.feedbackSessionsService.deleteSessionFromRecycleBin(s.feedbackSession.courseId,s.feedbackSession.feedbackSessionName).pipe((0,c.j)(()=>{this.isRestoreFeedbackSessionLoading=!1})).subscribe({next:n=>{this.recycleBinFeedbackSessionRowModels.splice(this.recycleBinFeedbackSessionRowModels.indexOf(s),1);const o={feedbackSession:n,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:n.privileges||(0,b.Ws)()};this.sessionsTableRowModels=[...this.sessionsTableRowModels,o],this.statusMessageService.showSuccessToast("The feedback session has been restored.")},error:n=>{this.statusMessageService.showErrorToast(n.error.message)}})}moveSessionToRecycleBinEventHandler(s){this.isMoveToRecycleBinLoading=!0;const n=this.sessionsTableRowModels[s];this.feedbackSessionsService.moveSessionToRecycleBin(n.feedbackSession.courseId,n.feedbackSession.feedbackSessionName).pipe((0,c.j)(()=>{this.isMoveToRecycleBinLoading=!1})).subscribe({next:o=>{this.sessionsTableRowModels.splice(this.sessionsTableRowModels.indexOf(n),1),this.recycleBinFeedbackSessionRowModels.push({feedbackSession:o}),this.statusMessageService.showSuccessToast("The feedback session has been deleted. You can restore it from the deleted sessions table below.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})}copySessionEventHandler(s){this.isCopySessionLoading=!0,this.failedToCopySessions={},this.coursesOfModifiedSession=[],this.modifiedSession={};const n=this.createSessionCopyRequestsFromRowModel(this.sessionsTableRowModels[s.sessionToCopyRowIndex],s);1===n.length&&this.copySingleSession(n[0].pipe((0,c.j)(()=>{this.isCopySessionLoading=!1})),this.modifiedTimestampsModal),n.length>1&&(0,v.p)(n).pipe((0,c.j)(()=>{this.isCopySessionLoading=!1})).subscribe(o=>{o.length>0&&o.forEach(t=>{const d={feedbackSession:t,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:t.privileges||(0,b.Ws)()};this.sessionsTableRowModels.push(d)}),this.showCopyStatusMessage(this.modifiedTimestampsModal)})}submitSessionAsInstructorEventHandler(s){this.submitSessionAsInstructor(this.sessionsTableRowModels[s])}publishSessionEventHandler(s){this.publishSession(this.sessionsTableRowModels[s.idx],s.rowData,s.columnsData)}unpublishSessionEventHandler(s){this.unpublishSession(this.sessionsTableRowModels[s.idx],s.rowData,s.columnsData)}downloadSessionResultEventHandler(s){this.downloadSessionResult(this.sessionsTableRowModels[s])}loadRecycleBinFeedbackSessions(){this.isRecycleBinLoading=!0,this.feedbackSessionsService.getFeedbackSessionsInRecycleBinForInstructor().pipe((0,c.j)(()=>{this.isRecycleBinLoading=!1})).subscribe({next:s=>{s.feedbackSessions.forEach(n=>{this.recycleBinFeedbackSessionRowModels.push({feedbackSession:n})})},error:s=>{this.resetAllModels(),this.hasFeedbackSessionLoadingFailed=!0,this.statusMessageService.showErrorToast(s.error.message)},complete:()=>this.sortRecycleBinFeedbackSessionRowsEvent(u.g.SESSION_DELETION_DATE)})}restoreAllRecycleBinFeedbackSession(){this.isRestoreFeedbackSessionLoading=!0;const s=[];this.recycleBinFeedbackSessionRowModels.forEach(n=>{s.push(this.feedbackSessionsService.deleteSessionFromRecycleBin(n.feedbackSession.courseId,n.feedbackSession.feedbackSessionName))}),(0,v.p)(s).pipe((0,c.j)(()=>{this.isRestoreFeedbackSessionLoading=!1})).subscribe({next:n=>{n.forEach(o=>{this.recycleBinFeedbackSessionRowModels=[];const t={feedbackSession:o,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:o.privileges||(0,b.Ws)()};this.sessionsTableRowModels=[...this.sessionsTableRowModels,t]}),this.statusMessageService.showSuccessToast("All sessions have been restored.")},error:n=>{this.statusMessageService.showErrorToast(n.error.message)}})}permanentDeleteSession(s){this.isPermanentDeleteLoading=!0;const n=this.ngbModal.open(I);n.componentInstance.courseId=s.feedbackSession.courseId,n.componentInstance.feedbackSessionName=s.feedbackSession.feedbackSessionName,n.result.then(()=>{this.feedbackSessionsService.deleteFeedbackSession(s.feedbackSession.courseId,s.feedbackSession.feedbackSessionName).pipe((0,c.j)(()=>{this.isPermanentDeleteLoading=!1})).subscribe({next:()=>{this.recycleBinFeedbackSessionRowModels.splice(this.recycleBinFeedbackSessionRowModels.indexOf(s),1),this.statusMessageService.showSuccessToast("The feedback session has been permanently deleted.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})}).catch(()=>{this.isPermanentDeleteLoading=!1})}permanentDeleteAllSessions(){this.isPermanentDeleteLoading=!0;const s=this.ngbModal.open(w);s.componentInstance.sessionsToDelete=this.recycleBinFeedbackSessionRowModels.map(n=>n.feedbackSession),s.result.then(()=>{const n=[];this.recycleBinFeedbackSessionRowModels.forEach(o=>{n.push(this.feedbackSessionsService.deleteFeedbackSession(o.feedbackSession.courseId,o.feedbackSession.feedbackSessionName))}),(0,v.p)(n).pipe((0,c.j)(()=>{this.isPermanentDeleteLoading=!1})).subscribe({next:()=>{this.recycleBinFeedbackSessionRowModels=[],this.statusMessageService.showSuccessToast("All sessions have been permanently deleted.")},error:o=>{this.statusMessageService.showErrorToast(o.error.message)}})}).catch(()=>{this.isPermanentDeleteLoading=!1})}retryLoadingAllData(){this.hasFeedbackSessionLoadingFailed=!1,this.hasCourseLoadingFailed=!1,this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}resetAllModels(){this.courseCandidates=[],this.sessionsTableRowModels=[],this.recycleBinFeedbackSessionRowModels=[]}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(G.x),e.rXU(x.o),e.rXU(A.u),e.rXU(V.q),e.rXU(S.Bq),e.rXU(X.b),e.rXU(Y.p),e.rXU(U.C),e.rXU($.r),e.rXU(H.W),e.rXU(z.Y),e.rXU(Z.D),e.rXU(W.f),e.rXU(_.nX))};static#s=this.\u0275cmp=e.VBU({type:i,selectors:[["tm-instructor-sessions-page"]],viewQuery:function(n,o){if(1&n&&e.GBs(ne,5),2&n){let t;e.mGM(t=e.lsd())&&(o.modifiedTimestampsModal=t.first)}},features:[e.Vt3],decls:18,vars:7,consts:[["class","alert alert-warning","role","alert",4,"ngIf"],["id","btn-add-session",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],["id","add-session-section","class","margin-top-30px",4,"ngIf"],[3,"shouldShowRetry","message","retryEvent"],[1,"margin-top-30px"],["class","table-responsive",4,"tmIsLoading"],[1,"row"],[1,"col-12","text-muted"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","isPermanentDeleteLoading","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent",4,"tmIsLoading"],["modifiedTimestampsModal",""],["role","alert",1,"alert","alert-warning"],["tmRouterLink","/web/instructor/courses"],["id","add-session-section",1,"margin-top-30px"],[3,"formMode","model","courseCandidates","templateSessions","isCopyOtherSessionLoading","modelChange","addNewSessionEvent","copyOtherSessionsEvent","closeEditFormEvent"],[1,"table-responsive"],["class","alert alert-warning margin-top-30px","role","alert",4,"ngIf"],["id","sessions-table",3,"sessionsTableRowModels","courseCandidates","columnsToShow","headerColorScheme","isSendReminderLoading","sortSessionsTableRowModelsEvent","loadResponseRateEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToAllNonSubmittersEvent","sendRemindersToSelectedNonSubmittersEvent",4,"tmIsLoading"],["role","alert",1,"alert","alert-warning","margin-top-30px"],["id","sessions-table",3,"sessionsTableRowModels","courseCandidates","columnsToShow","headerColorScheme","isSendReminderLoading","sortSessionsTableRowModelsEvent","loadResponseRateEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToAllNonSubmittersEvent","sendRemindersToSelectedNonSubmittersEvent"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","isPermanentDeleteLoading","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent"],[3,"coursesOfModifiedSession","modifiedSessions"]],template:function(n,o){1&n&&(e.DNE(0,te,5,0,"div",0),e.j41(1,"div")(2,"button",1),e.bIt("click",function(){return o.isSessionEditFormExpanded=!0}),e.nrm(3,"i",2),e.EFF(4," Add New Feedback Session "),e.k0s()(),e.DNE(5,ie,3,6,"div",3),e.j41(6,"tm-loading-retry",4),e.bIt("retryEvent",function(){return o.retryLoadingAllData()}),e.j41(7,"div",5),e.DNE(8,le,3,2,"div",6),e.k0s(),e.nrm(9,"br"),e.j41(10,"div",7)(11,"div",8)(12,"p"),e.EFF(13," Note: The table above doesn't contain sessions from archived courses and courses in recycle bin. To view sessions from an archived course, unarchive the course first; to view sessions from a course in recycle bin, restore the course first. "),e.k0s()()(),e.j41(14,"div",5),e.DNE(15,ce,1,5,"tm-sessions-recycle-bin-table",9),e.k0s()(),e.DNE(16,me,1,2,"ng-template",null,10,e.C5r)),2&n&&(e.Y8G("ngIf",!o.isCoursesLoading&&0===o.courseCandidates.length&&!o.hasCourseLoadingFailed),e.R7$(2),e.Y8G("disabled",o.isSessionEditFormExpanded||o.isCoursesLoading),e.R7$(3),e.Y8G("ngIf",o.isSessionEditFormExpanded&&!o.isCoursesLoading),e.R7$(1),e.Y8G("shouldShowRetry",o.hasCourseLoadingFailed||o.hasFeedbackSessionLoadingFailed)("message","Failed to load data"),e.R7$(2),e.Y8G("tmIsLoading",o.isCoursesLoading||o.isMoveToRecycleBinLoading||o.isCopySessionLoading||o.isResultActionLoading),e.R7$(7),e.Y8G("tmIsLoading",o.isRecycleBinLoading||o.isRestoreFeedbackSessionLoading))},dependencies:[h.bT,Q.I,J.l,K.T,q.n,ee.Y,se.y,oe.U],styles:[".margin-top-30px[_ngcontent-%COMP%]{margin-top:30px}.sortable-header[_ngcontent-%COMP%]{cursor:pointer}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}.text-color-lightgray[_ngcontent-%COMP%]{color:#d3d3d3}"],data:{animation:[P.j]}})}return i})();var he=r(34029),Se=r(84309),be=r(28324),pe=r(16781),ve=r(95115),fe=r(22647),ge=r(44661),_e=r(48381);const Ee=[{path:"",component:ue}];let Fe=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#s=this.\u0275mod=e.$C({type:i});static#o=this.\u0275inj=e.G2t({imports:[h.MD,pe.$,ge.x,m.YN,fe.k,ve.O,_.iI.forChild(Ee),Se.y,he.Z,_e.d,be.t]})}return i})()}}]);