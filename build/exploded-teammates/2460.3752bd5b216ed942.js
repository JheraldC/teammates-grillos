"use strict";(self.webpackChunkteammates=self.webpackChunkteammates||[]).push([[2460],{13406:(R,I,r)=>{r.d(I,{p:()=>_});var e=r(94227),h=r(96508),C=r.n(h),g=r(17705);const T="ddd, DD MMM, YYYY";let _=(()=>{class n extends e.tN{format(v){if(null==v)return"";const t=C()();return t.set("year",v.year),t.set("month",v.month-1),t.set("date",v.day),t.format(T)}parse(v){const t=C()(v,T);return{year:t.year(),month:t.month()+1,day:t.date()}}static#t=this.\u0275fac=function(){let v;return function(O){return(v||(v=g.xGo(n)))(O||n)}}();static#e=this.\u0275prov=g.jDH({token:n,factory:n.\u0275fac})}return n})()},86082:(R,I,r)=>{r.d(I,{F:()=>T});var e=r(17705),h=r(60177);function C(_,n){if(1&_&&e.nrm(0,"i",3),2&_){const c=e.XpG();e.xc7("color",c.chevronColor)}}function g(_,n){if(1&_&&e.nrm(0,"i",4),2&_){const c=e.XpG();e.xc7("color",c.chevronColor)}}let T=(()=>{class _{constructor(){this.isExpanded=!1,this.chevronColor="white"}static#t=this.\u0275fac=function(v){return new(v||_)};static#e=this.\u0275cmp=e.VBU({type:_,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded",chevronColor:"chevronColor"},decls:3,vars:3,consts:[["type","button","aria-label","Expand panel",1,"chevron","btn-course","btn","btn-primary","btn-sm"],["class","fas fa-chevron-down",3,"color",4,"ngIf"],["class","fas fa-chevron-up",3,"color",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(v,t){1&v&&(e.j41(0,"button",0),e.DNE(1,C,1,2,"i",1),e.DNE(2,g,1,2,"i",2),e.k0s()),2&v&&(e.BMQ("aria-expanded",t.isExpanded),e.R7$(1),e.Y8G("ngIf",!t.isExpanded),e.R7$(1),e.Y8G("ngIf",t.isExpanded))},dependencies:[h.bT],styles:["button.chevron[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;background-color:inherit;border-width:0}button.chevron[_ngcontent-%COMP%]:active{background-color:inherit}"]})}return _})()},57125:(R,I,r)=>{r.d(I,{o:()=>C});var e=r(60177),h=r(17705);let C=(()=>{class g{static#t=this.\u0275fac=function(n){return new(n||g)};static#e=this.\u0275mod=h.$C({type:g});static#o=this.\u0275inj=h.G2t({imports:[e.MD]})}return g})()},7730:(R,I,r)=>{r.d(I,{c:()=>B,u:()=>L});var e=r(17705),h=r(26195),C=r(16),g=r(60177),T=r(94227),_=r(99488);function n(l,D){1&l&&e.nrm(0,"i",13)}function c(l,D){1&l&&e.nrm(0,"i",14)}const v=function(l){return{"ngb-tooltip-class":l}};function t(l,D){if(1&l&&(e.j41(0,"button",7)(1,"span",8),e.EFF(2),e.k0s(),e.j41(3,"span",9),e.nrm(4,"i",10),e.DNE(5,n,1,0,"i",11),e.DNE(6,c,1,0,"i",12),e.k0s()()),2&l){const i=e.XpG().$implicit,f=e.XpG();e.R7$(1),e.Y8G("ngClass",e.eq3(5,v,i.headerToolTip))("ngbTooltip",i.headerToolTip),e.R7$(1),e.JRh(i.header),e.R7$(3),e.Y8G("ngIf",i.sortBy&&f.columnToSortBy===i.header&&f.sortOrder===f.SortOrder.DESC),e.R7$(1),e.Y8G("ngIf",i.sortBy&&f.columnToSortBy===i.header&&f.sortOrder===f.SortOrder.ASC)}}function O(l,D){if(1&l&&(e.j41(0,"span",15),e.EFF(1),e.k0s()),2&l){const i=e.XpG().$implicit;e.Y8G("ngbTooltip",i.headerToolTip)("ngClass",e.eq3(3,v,i.headerToolTip)),e.R7$(1),e.JRh(i.header)}}const u=function(l){return{"sortable-header":l}};function p(l,D){if(1&l){const i=e.RV6();e.j41(0,"th",4),e.bIt("click",function(){const A=e.eBV(i).$implicit,$=e.XpG();return e.Njj(A.sortBy&&$.onClickHeader(A.header))}),e.DNE(1,t,7,7,"button",5),e.DNE(2,O,2,5,"span",6),e.k0s()}if(2&l){const i=D.$implicit,f=e.XpG();e.HbH(null==i?null:i.headerClass),e.Y8G("ngClass",e.eq3(8,u,i.sortBy))("ngStyle",f.getAlignment(i)),e.BMQ("aria-sort",f.getAriaSort(i.header)),e.R7$(1),e.Y8G("ngIf",i.sortBy),e.R7$(1),e.Y8G("ngIf",!i.sortBy)}}function b(l,D){if(1&l&&e.nrm(0,"ndc-dynamic",19),2&l){const i=e.XpG().$implicit,f=e.XpG().index;e.Y8G("ngComponentOutlet",i.customComponent.component)("ndcDynamicInputs",i.customComponent.componentData(f))}}function k(l,D){if(1&l&&(e.qex(0),e.nrm(1,"span",20),e.bVm()),2&l){const i=e.XpG().$implicit;e.R7$(1),e.Y8G("innerHTML",i.displayValue,e.npT)}}function N(l,D){if(1&l&&(e.qex(0),e.EFF(1),e.bVm()),2&l){const i=e.XpG().$implicit;e.R7$(1),e.JRh(i.value)}}function G(l,D){if(1&l&&(e.j41(0,"td"),e.DNE(1,b,1,2,"ndc-dynamic",17),e.DNE(2,k,2,1,"ng-container",18),e.DNE(3,N,2,1,"ng-container",18),e.k0s()),2&l){const i=D.$implicit,f=e.XpG(2);e.Aen(f.getStyle(i)),e.R7$(1),e.Y8G("ngIf",i.customComponent),e.R7$(1),e.Y8G("ngIf",!i.customComponent&&i.displayValue),e.R7$(1),e.Y8G("ngIf",!i.customComponent&&!i.displayValue)}}function x(l,D){if(1&l&&(e.j41(0,"tr"),e.DNE(1,G,4,5,"td",16),e.k0s()),2&l){const i=D.$implicit;e.R7$(1),e.Y8G("ngForOf",i)}}var L=function(l){return l[l.BLUE=0]="BLUE",l[l.WHITE=1]="WHITE",l[l.OTHERS=2]="OTHERS",l}(L||{});let B=(()=>{class l{constructor(i){this.tableComparatorService=i,this.SortOrder=h.x,this.tableId="",this.headerColorScheme=L.BLUE,this.customHeaderStyle="",this.columns=[],this.rows=[],this.initialSortBy=h.g.NONE,this.sortOrder=h.x.ASC,this.sortEvent=new e.bkB,this.columnToSortBy="",this.tableRows=[],this.setMainTableStyle=!0}ngOnInit(){this.tableRows=this.rows,this.initialSort(),this.setMainTableStyle=this.headerColorScheme===L.BLUE}ngOnChanges(){this.tableRows=this.rows,this.sortRows()}onClickHeader(i){this.sortOrder=this.columnToSortBy===i&&this.sortOrder===h.x.ASC?h.x.DESC:h.x.ASC,this.columnToSortBy=i,this.sortRows()}getAriaSort(i){return i!==this.columnToSortBy?"none":this.sortOrder===h.x.ASC?"ascending":"descending"}sortRows(){if(!this.columnToSortBy)return;const i=this.columns.findIndex(y=>y.header===this.columnToSortBy);if(i<0)return;const f=this.columns[i].sortBy;f&&(this.sortEvent.emit({sortBy:f,sortOrder:this.sortOrder}),this.tableRows.sort((y,A)=>this.tableComparatorService.compare(f,this.sortOrder,String(y[i].value),String(A[i].value))))}initialSort(){const i=this.columns.findIndex(f=>f.sortBy===this.initialSortBy);i<0||(this.columnToSortBy=this.columns[i].header,this.sortRows())}getStyle(i){return i.style}getAlignment(i){return{"text-align":`${i?.alignment||"start"}`}}static#t=this.\u0275fac=function(f){return new(f||l)(e.rXU(C.C))};static#e=this.\u0275cmp=e.VBU({type:l,selectors:[["tm-sortable-table"]],inputs:{tableId:"tableId",headerColorScheme:"headerColorScheme",customHeaderStyle:"customHeaderStyle",columns:"columns",rows:"rows",initialSortBy:"initialSortBy",sortOrder:"sortOrder"},outputs:{sortEvent:"sortEvent"},features:[e.OA$],decls:6,vars:3,consts:[[1,"table","table-bordered","table-striped"],[3,"ngClass"],[3,"ngClass","class","ngStyle","click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"ngClass","ngStyle","click"],["class","d-lg-flex align-items-center gap-lg-1 d-inline ",4,"ngIf"],["container","body",3,"ngbTooltip","ngClass",4,"ngIf"],[1,"d-lg-flex","align-items-center","gap-lg-1","d-inline"],["container","body",3,"ngClass","ngbTooltip"],["aria-hidden","true",1,"fa-stack"],[1,"fas","fa-sort"],["class","fas fa-sort-down",4,"ngIf"],["class","fas fa-sort-up",4,"ngIf"],[1,"fas","fa-sort-down"],[1,"fas","fa-sort-up"],["container","body",3,"ngbTooltip","ngClass"],[3,"style",4,"ngFor","ngForOf"],[3,"ngComponentOutlet","ndcDynamicInputs",4,"ngIf"],[4,"ngIf"],[3,"ngComponentOutlet","ndcDynamicInputs"],[3,"innerHTML"]],template:function(f,y){1&f&&(e.j41(0,"table",0)(1,"thead")(2,"tr",1),e.DNE(3,p,3,10,"th",2),e.k0s()(),e.j41(4,"tbody"),e.DNE(5,x,2,1,"tr",3),e.k0s()()),2&f&&(e.R7$(2),e.Y8G("ngClass",y.setMainTableStyle?"bg-primary text-white":y.customHeaderStyle),e.R7$(1),e.Y8G("ngForOf",y.columns),e.R7$(2),e.Y8G("ngForOf",y.tableRows))},dependencies:[g.YU,g.OI,g.Sq,g.bT,g.B3,T.md,_.Bf,_.ar,_.dE],styles:[".sortable-header[_ngcontent-%COMP%]{cursor:pointer}.sortable-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.3em}.sortable-header[_ngcontent-%COMP%]   .fa-stack[_ngcontent-%COMP%]{width:20%}.sortable-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;color:inherit;border:none;padding:0;text-align:left;width:100%;font:inherit;cursor:inherit}th[_ngcontent-%COMP%]{vertical-align:middle}"]})}return l})()},42138:(R,I,r)=>{r.d(I,{n:()=>v});var e=r(17705),h=r(47650),C=r(60177),g=r(89417);const T=function(t){return{hour:t,minute:0}};function _(t,O){if(1&t&&(e.j41(0,"option",2),e.EFF(1),e.k0s()),2&t){const u=O.$implicit,p=e.XpG();e.Y8G("ngValue",e.eq3(3,T,u))("disabled",p.isOptionDisabled(e.eq3(5,T,u))),e.R7$(1),e.SpI(" ",p.addLeadingZeros(2,u),":00H ")}}function n(t,O){if(1&t&&(e.j41(0,"option",4),e.EFF(1),e.k0s()),2&t){const u=e.XpG();e.Y8G("ngValue",u.time),e.R7$(1),e.Lme("",u.addLeadingZeros(2,u.time.hour),":",u.addLeadingZeros(2,u.time.minute),"H")}}const c=function(){return{hour:23,minute:59}};let v=(()=>{class t{constructor(){this.isDisabled=!1,this.time=(0,h.qt)(),this.date=(0,h.l$)(),this.timeChange=new e.bkB}triggerTimeChange(u){this.timeChange.emit(u)}range(u,p){const b=[];for(let k=u;k<p;k+=1)b.push(k);return b}timeCompareFn(u,p){return u&&p&&u.hour===p.hour&&u.minute===p.minute}isOptionDisabled(u){const p=this.toJsDate(this.date,u);return!!(this.minDate&&this.minTime&&p<this.toJsDate(this.minDate,this.minTime))||!!(this.maxDate&&this.maxTime&&p>this.toJsDate(this.maxDate,this.maxTime))}toJsDate(u,p){return new Date(u.year,u.month-1,u.day,p.hour,p.minute)}isInFixedList(u){return u.hour>=1&&u.hour<=23&&0===u.minute||23===u.hour&&59===u.minute}addLeadingZeros(u,p){return("0".repeat(u)+p).slice(-u)}static#t=this.\u0275fac=function(p){return new(p||t)};static#e=this.\u0275cmp=e.VBU({type:t,selectors:[["tm-timepicker"]],inputs:{isDisabled:"isDisabled",time:"time",minTime:"minTime",maxTime:"maxTime",date:"date",minDate:"minDate",maxDate:"maxDate"},outputs:{timeChange:"timeChange"},decls:5,vars:9,consts:[["aria-label","Select time",1,"form-control","form-select",3,"ngModel","disabled","compareWith","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],[3,"ngValue","disabled"],[3,"ngValue",4,"ngIf"],[3,"ngValue"]],template:function(p,b){1&p&&(e.j41(0,"select",0),e.bIt("ngModelChange",function(N){return b.triggerTimeChange(N)}),e.DNE(1,_,2,7,"option",1),e.j41(2,"option",2),e.EFF(3,"23:59H"),e.k0s(),e.DNE(4,n,2,3,"option",3),e.k0s()),2&p&&(e.Y8G("ngModel",b.time)("disabled",b.isDisabled)("compareWith",b.timeCompareFn),e.R7$(1),e.Y8G("ngForOf",b.range(1,24)),e.R7$(1),e.Y8G("ngValue",e.lJ4(7,c))("disabled",b.isOptionDisabled(e.lJ4(8,c))),e.R7$(2),e.Y8G("ngIf",!b.isInFixedList(b.time)))},dependencies:[C.Sq,C.bT,g.xH,g.y7,g.wz,g.BC,g.vS]})}return t})()},82460:(R,I,r)=>{r.r(I),r.d(I,{InstructorStudentActivityLogsModule:()=>tt});var e=r(60177),h=r(89417),C=r(82646),g=r(94227),T=r(70980),_=r(8059),n=r(47650),c=r(26195),v=r(13406),t=r(17705),O=r(89734),u=r(43743),p=r(86978),b=r(28735),k=r(50833),N=r(30715),G=r(57645),x=r(86082),L=r(7730),B=r(42138);function l(d,S){if(1&d&&(t.j41(0,"option",43),t.EFF(1),t.k0s()),2&d){const o=S.$implicit;t.Y8G("value",o.value),t.R7$(1),t.SpI(" ",o.label," ")}}const D=function(d,S){return{studentEmail:d,studentId:S}};function i(d,S){if(1&d&&(t.j41(0,"option",36),t.EFF(1),t.k0s()),2&d){const o=S.$implicit;t.Y8G("ngValue",t.l_i(3,D,o.email||"",o.studentId)),t.R7$(1),t.Lme(" ",o.name," ",o.email?"<"+o.email+">":""," ")}}const f=function(d,S){return{feedbackSessionName:d,sessionId:S}};function y(d,S){if(1&d&&(t.j41(0,"option",36),t.EFF(1),t.k0s()),2&d){const o=S.$implicit;t.Y8G("ngValue",t.l_i(2,f,o.key,o.value.sessionId)),t.R7$(1),t.SpI(" ",o.key," ")}}const A=function(){return{feedbackSessionName:"",sessionId:""}};function $(d,S){if(1&d){const o=t.RV6();t.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"label",8),t.EFF(6,"Activity Type"),t.k0s()(),t.j41(7,"div",7)(8,"select",9),t.bIt("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.logType=s)})("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.triggerDefaultLogActivityTypeChange(s))}),t.j41(9,"option",10),t.EFF(10,"Select Activity Type"),t.k0s(),t.DNE(11,l,2,2,"option",11),t.k0s()()(),t.j41(12,"div",12)(13,"div",13)(14,"label",14),t.EFF(15,"Search period from"),t.k0s()(),t.j41(16,"div",15)(17,"div",16)(18,"input",17,18),t.bIt("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.logsDateFrom=s)}),t.k0s(),t.j41(20,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.sdS(19);return t.Njj(s.toggle())}),t.nrm(21,"i",20),t.k0s()(),t.j41(22,"div",21)(23,"tm-timepicker",22),t.bIt("timeChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.logsTimeFrom=s)}),t.k0s()()()()(),t.j41(24,"div",5)(25,"div",6)(26,"div",7)(27,"label",23),t.EFF(28,"Student Name (Optional)"),t.k0s()(),t.j41(29,"div",7)(30,"select",24),t.bIt("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.selectedStudent=s)}),t.DNE(31,i,2,6,"option",25),t.k0s()()(),t.j41(32,"div",12)(33,"div",13)(34,"label",26),t.EFF(35,"Search period until"),t.k0s()(),t.j41(36,"div",15)(37,"div",27)(38,"input",28,29),t.bIt("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.logsDateTo=s)}),t.k0s(),t.j41(40,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.sdS(39);return t.Njj(s.toggle())}),t.nrm(41,"i",20),t.k0s()(),t.j41(42,"div",21)(43,"tm-timepicker",30),t.bIt("timeChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.logsTimeTo=s)}),t.k0s()(),t.j41(44,"div",31)(45,"button",32),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.search())}),t.EFF(46,"Search"),t.k0s()()()()(),t.j41(47,"div",5)(48,"div",33)(49,"div",7)(50,"label",34),t.EFF(51,"Feedback Session Name (Optional)"),t.k0s()(),t.j41(52,"div",7)(53,"select",35),t.bIt("ngModelChange",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.formModel.selectedSession=s)}),t.nrm(54,"option",36),t.DNE(55,y,2,5,"option",25),t.nI1(56,"keyvalue"),t.k0s()()(),t.j41(57,"div",37)(58,"div",38)(59,"label",39)(60,"input",40),t.bIt("click",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.triggerModelChange("showActions",s.target.checked))}),t.k0s(),t.EFF(61," Show actions "),t.k0s(),t.j41(62,"label",41)(63,"input",42),t.bIt("click",function(s){t.eBV(o);const m=t.XpG();return t.Njj(m.triggerModelChange("showInactions",s.target.checked))}),t.k0s(),t.EFF(64," Show inactions "),t.k0s()()()()()()}if(2&d){const o=t.XpG();t.R7$(8),t.Y8G("ngModel",o.formModel.logType),t.R7$(3),t.Y8G("ngForOf",o.LOG_TYPES),t.R7$(7),t.Y8G("minDate",o.earliestSearchDate)("maxDate",o.formModel.logsDateTo)("ngModel",o.formModel.logsDateFrom),t.R7$(5),t.Y8G("time",o.formModel.logsTimeFrom),t.R7$(7),t.Y8G("ngModel",o.formModel.selectedStudent),t.R7$(1),t.Y8G("ngForOf",o.students),t.R7$(7),t.Y8G("minDate",o.formModel.logsDateFrom)("maxDate",o.dateToday)("ngModel",o.formModel.logsDateTo),t.R7$(5),t.Y8G("time",o.formModel.logsTimeTo),t.R7$(2),t.Y8G("disabled",""===o.course.courseId||o.isSearching),t.R7$(8),t.Y8G("ngModel",o.formModel.selectedSession),t.R7$(1),t.Y8G("ngValue",t.lJ4(20,A)),t.R7$(1),t.Y8G("ngForOf",t.bMT(56,18,o.feedbackSessions)),t.R7$(5),t.Y8G("checked",o.formModel.showActions),t.R7$(3),t.Y8G("checked",o.formModel.showInactions)}}function w(d,S){if(1&d&&(t.j41(0,"div",52),t.nrm(1,"tm-sortable-table",53),t.k0s()),2&d){const o=t.XpG(2).$implicit,a=t.XpG(2);t.R7$(1),t.Y8G("rows",o.logRowsData)("columns",o.logColumnsData)("initialSortBy",a.SortBy.GIVER_NAME)}}function U(d,S){1&d&&(t.j41(0,"div",54)(1,"i"),t.EFF(2,"No activity for this feedback session in selected search period"),t.k0s()())}function V(d,S){if(1&d&&(t.j41(0,"div"),t.DNE(1,w,2,3,"div",50),t.DNE(2,U,3,0,"ng-template",null,51,t.C5r),t.k0s()),2&d){const o=t.sdS(3),a=t.XpG().$implicit;t.R7$(1),t.Y8G("ngIf",a.logRowsData[0])("ngIfElse",o)}}const X=function(d,S){return{"alert-success-border":d,"alert-failure-border":S}},K=function(d,S){return{"alert-success":d,"alert-failure":S}};function P(d,S){if(1&d){const o=t.RV6();t.j41(0,"div")(1,"div",45)(2,"div",46),t.bIt("click",function(){const m=t.eBV(o).$implicit;return t.Njj(m.isTabExpanded=!m.isTabExpanded)}),t.EFF(3),t.j41(4,"div",47),t.nrm(5,"tm-panel-chevron",48),t.k0s()(),t.DNE(6,V,4,2,"div",49),t.k0s()()}if(2&d){const o=S.$implicit;t.R7$(1),t.Y8G("ngClass",t.l_i(5,X,o.logRowsData.length,!o.logRowsData.length)),t.R7$(1),t.Y8G("ngClass",t.l_i(8,K,o.logRowsData.length,!o.logRowsData.length)),t.R7$(1),t.SpI(" ",o.feedbackSessionName," "),t.R7$(2),t.Y8G("isExpanded",o.isTabExpanded),t.R7$(1),t.Y8G("ngIf",o.isTabExpanded)}}function W(d,S){if(1&d&&(t.j41(0,"div"),t.DNE(1,P,7,11,"div",44),t.k0s()),2&d){const o=t.XpG();t.R7$(1),t.Y8G("ngForOf",o.searchResults)}}let H=(()=>{class d{constructor(o,a,s,m,E,M,F){this.route=o,this.courseService=a,this.feedbackSessionsService=s,this.studentService=m,this.logsService=E,this.timezoneService=M,this.statusMessageService=F,this.LOGS_DATE_TIME_FORMAT="ddd, DD MMM YYYY hh:mm:ss A",this.LOGS_RETENTION_PERIOD=_.YU.LOGS_RETENTION_PERIOD,this.STUDENT_ACTIVITY_LOGS_UPDATE_INTERVAL=_.YU.STUDENT_ACTIVITY_LOGS_UPDATE_INTERVAL,this.LOG_TYPES=[{label:"session access",value:"access"},{label:"session submission",value:"submission"},{label:"session access and submission",value:"access,submission"},{label:"view session results",value:"view result"}],this.SortBy=c.g,this.formModel={logsDateFrom:(0,n.l$)(),logsTimeFrom:(0,n.qt)(),logsDateTo:(0,n.l$)(),logsTimeTo:(0,n.qt)(),logType:"",selectedStudent:{studentEmail:"",studentId:""},selectedSession:{feedbackSessionName:"",sessionId:""},showActions:!1,showInactions:!1},this.course={courseId:"",courseName:"",institute:"",timeZone:"",creationTimestamp:0,deletionTimestamp:0},this.dateToday=(0,n.l$)(),this.earliestSearchDate=(0,n.l$)(),this.studentLogsMap=new Map,this.students=[],this.feedbackSessions=new Map,this.searchResults=[],this.isLoading=!0,this.isSearching=!1,this.lastUpdated=""}ngOnInit(){this.route.queryParams.subscribe(o=>{const a=o.courseid;this.loadControlPanel(),this.loadCourse(a),this.loadFeedbackSessions(a),this.loadStudents(a)})}loadControlPanel(){const o=new Date;this.dateToday.year=o.getFullYear(),this.dateToday.month=o.getMonth()+1,this.dateToday.day=o.getDate();const a=new Date(Date.now()-this.LOGS_RETENTION_PERIOD*n.l5.IN_ONE_DAY);this.earliestSearchDate.year=a.getFullYear(),this.earliestSearchDate.month=a.getMonth()+1,this.earliestSearchDate.day=a.getDate();const s=new Date;s.setDate(o.getDate()-1),this.formModel.logsDateFrom={year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate()},this.formModel.logsDateTo={...this.dateToday},this.formModel.logsTimeFrom=(0,n.gW)(),this.formModel.logsTimeTo=(0,n.gW)()}search(){if(""===this.formModel.logType)return void this.statusMessageService.showErrorToast("Please select an activity type");this.studentLogsMap=new Map,this.searchResults=[],this.isSearching=!0;const o=this.course.timeZone,a=this.timezoneService.resolveLocalDateTime(this.formModel.logsDateFrom,this.formModel.logsTimeFrom,o,!0),s=this.timezoneService.resolveLocalDateTime(this.formModel.logsDateTo,this.formModel.logsTimeTo,o,!0);this.logsService.searchFeedbackSessionLog({courseId:this.course.courseId,searchFrom:a.toString(),searchUntil:s.toString(),studentEmail:this.formModel.selectedStudent.studentEmail,logType:this.formModel.logType,sessionName:this.formModel.selectedSession.feedbackSessionName,studentId:this.formModel.selectedStudent.studentId,sessionId:this.formModel.selectedSession.sessionId}).pipe((0,T.j)(()=>{this.isSearching=!1})).subscribe({next:m=>{if(""===this.formModel.selectedSession.feedbackSessionName)m.feedbackSessionLogs.forEach(E=>{E.feedbackSessionLogEntries.forEach(M=>{const F=this.studentLogsMap.get(this.getStudentKey(E,M.studentData.email));F?F.push(M):this.studentLogsMap.set(this.getStudentKey(E,M.studentData.email),[M])}),this.searchResults.push(this.toFeedbackSessionLogModel(E))});else{const E=m.feedbackSessionLogs.find(M=>M.feedbackSessionData.feedbackSessionName===this.formModel.selectedSession.feedbackSessionName);E&&(E.feedbackSessionLogEntries.forEach(M=>{const F=this.studentLogsMap.get(this.getStudentKey(E,M.studentData.email));F?F.push(M):this.studentLogsMap.set(this.getStudentKey(E,M.studentData.email),[M])}),this.searchResults.push(this.toFeedbackSessionLogModel(E)))}},error:m=>{this.statusMessageService.showErrorToast(m.error.message)}})}loadCourse(o){this.courseService.getCourseAsInstructor(o).pipe((0,T.j)(()=>{this.isLoading=!1})).subscribe({next:a=>{this.course=a,this.setLastUpdated()},error:a=>this.statusMessageService.showErrorToast(a.error.message)})}loadFeedbackSessions(o){this.feedbackSessionsService.getFeedbackSessionsForInstructor(o).subscribe({next:a=>{a.feedbackSessions.forEach(s=>{this.feedbackSessions.set(s.feedbackSessionName,s)})},error:a=>this.statusMessageService.showErrorToast(a.error.message)})}loadStudents(o){0===this.students.length&&(this.isLoading=!0,this.studentService.getStudentsFromCourse({courseId:o}).pipe((0,T.j)(()=>{this.isLoading=!1})).subscribe(({students:a})=>{a.sort((m,E)=>m.name.localeCompare(E.name)),this.students=[{courseId:"",email:"",name:"",sectionName:"",teamName:""},...a]}))}toFeedbackSessionLogModel(o){return{feedbackSessionName:o.feedbackSessionData.feedbackSessionName,logColumnsData:[{header:"Status",sortBy:c.g.RESULT_VIEW_STATUS},{header:"Name",sortBy:c.g.GIVER_NAME},{header:"Email",sortBy:c.g.RESPONDENT_EMAIL},{header:"Section",sortBy:c.g.SECTION_NAME},{header:"Team",sortBy:c.g.TEAM_NAME}],logRowsData:this.students.filter(s=>{if(""===s.email||""!==this.formModel.selectedStudent.studentEmail&&s.email!==this.formModel.selectedStudent.studentEmail)return!1;if(this.formModel.showInactions&&this.formModel.showActions)return!0;const m=this.getStudentKey(o,s.email);if(this.studentLogsMap.has(m)){if(this.formModel.showInactions)return!1}else if(this.formModel.showActions)return!1;return!0}).flatMap(s=>{let m,E="font-family:monospace; white-space:pre;";const M=this.getStudentKey(o,s.email),F=this.studentLogsMap.get(M),j=[];return F?F.forEach(Y=>{const et=this.timezoneService.formatToString(Y.timestamp,o.feedbackSessionData.timeZone,this.LOGS_DATE_TIME_FORMAT);m=`${this.logTypeToActivityDisplay(Y.feedbackSessionLogType)} at ${et}`,m=m.charAt(0).toUpperCase()+m.slice(1),j.push([{value:m,style:E},{value:s.name},{value:s.email},{value:s.sectionName},{value:s.teamName}])}):(m=`Not ${this.logTypeToActivityDisplay(this.formModel.logType)} within the query range`,E+="color:red;",j.push([{value:m,style:E},{value:s.name},{value:s.email},{value:s.sectionName},{value:s.teamName}])),j}),isTabExpanded:0!==o.feedbackSessionLogEntries.length&&this.formModel.showActions||0===o.feedbackSessionLogEntries.length&&this.formModel.showInactions}}logTypeToActivityDisplay(o){switch(o.toUpperCase()){case"ACCESS":return"viewed the submission page";case"SUBMISSION":return"submitted responses";case"VIEW_RESULT":case"VIEW RESULT":return"viewed the session results";case"ACCESS,SUBMISSION":return"viewed the submission page or submitted responses";default:return"unknown activity"}}getStudentKey(o,a){return`${o.feedbackSessionData.feedbackSessionName}-${a}`}triggerDefaultLogActivityTypeChange(o){"view result"===o?(this.formModel.showInactions=!0,this.formModel.showActions=!1):(this.formModel.showInactions=!1,this.formModel.showActions=!0)}triggerModelChange(o,a){this.formModel={...this.formModel,[o]:a}}setLastUpdated(){const a=new Date,s=a.getMinutes()%15,m=a.getTime()-(15+s)*n.l5.IN_ONE_MINUTE;this.lastUpdated=this.timezoneService.formatToString(m,this.course.timeZone,"DD MMM YYYY, hh:mm A")}static#t=this.\u0275fac=function(a){return new(a||d)(t.rXU(C.nX),t.rXU(O.f),t.rXU(u.u),t.rXU(p.b),t.rXU(b.K),t.rXU(k.D),t.rXU(N.x))};static#e=this.\u0275cmp=t.VBU({type:d,selectors:[["tm-instructor-student-activity-logs"]],features:[t.Jv_([{provide:g.tN,useClass:v.p}])],decls:25,vars:6,consts:[["class","card bg-form no-border",4,"tmIsLoading"],["id","logs-output"],[4,"tmIsLoading"],[1,"card","bg-form","no-border"],[1,"card-body"],[1,"row","form-group"],[1,"col-4"],[1,"col-12"],["for","activity-type-dropdown",1,"fw-bold"],["id","activity-type-dropdown",1,"form-control","form-select","col-12",3,"ngModel","ngModelChange"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-8"],[1,"col-12","mb-1"],[1,"fw-bold"],[1,"input-group"],["id","logs-from-datepicker",1,"col-md-6","input-group"],["type","text","ngbDatepicker","","readonly","","aria-label","Date to search from",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsFromDp","ngbDatepicker"],["aria-label","Change date","type","button",1,"btn","btn-light",3,"click"],[1,"fas","fa-calendar-alt"],[1,"col-md-3"],["id","logs-from-timepicker",3,"time","timeChange"],["for","student-name-dropdown",1,"fw-bold"],["id","student-name-dropdown",1,"form-control","form-select","col-12",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["for","logs-to-datepicker",1,"fw-bold"],["id","logs-to-datepicker",1,"col-md-6","input-group"],["type","text","ngbDatepicker","","readonly","","aria-label","Date to search until",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsToDp","ngbDatepicker"],["id","logs-to-timepicker","aria-label","Search period until time",3,"time","timeChange"],[1,"col-md-2"],["id","search-button",1,"float-end","btn","btn-primary",3,"disabled","click"],[1,"col-5"],["for","session-dropdown",1,"fw-bold"],["id","session-dropdown",1,"form-control","form-select","col-md-12",3,"ngModel","ngModelChange"],[3,"ngValue"],[1,"row","mt-md-1","ms-md-3"],[1,"col-12","form-check",2,"margin-top","30px"],[1,"form-check-label"],["id","show-actions","type","checkbox","name","showActions",1,"form-check-input",3,"checked","click"],[1,"form-check-label",2,"margin-left","40px"],["id","show-inactions","type","checkbox","name","showInactions",1,"form-check-input",3,"checked","click"],[3,"value"],[4,"ngFor","ngForOf"],[1,"card","mb-3",3,"ngClass"],[1,"card-header","cursor-pointer","text-break",3,"ngClass","click"],[1,"card-header-btn-toolbar"],[3,"isExpanded"],[4,"ngIf"],["class","card-body mb-4",4,"ngIf","ngIfElse"],["noActivityTemplate",""],[1,"card-body","mb-4"],[3,"rows","columns","initialSortBy"],[1,"no-activity-body"]],template:function(a,s){1&a&&(t.j41(0,"h1"),t.EFF(1),t.k0s(),t.j41(2,"p"),t.EFF(3,"This page allows you to find when your students have accessed or submitted a particular feedback session or view a session results. Note that you can only view student logs if you have "),t.j41(4,"b"),t.EFF(5,"owner or manager privileges"),t.k0s(),t.EFF(6," for the course. The earliest date you can search for is "),t.j41(7,"b"),t.EFF(8),t.k0s(),t.EFF(9," before today."),t.k0s(),t.j41(10,"p"),t.EFF(11,"Please note that recent activity after "),t.j41(12,"b"),t.EFF(13),t.k0s(),t.EFF(14," may "),t.j41(15,"b"),t.EFF(16,"NOT"),t.k0s(),t.EFF(17," be shown as the information is updated in "),t.j41(18,"b"),t.EFF(19),t.k0s(),t.EFF(20," intervals."),t.k0s(),t.nrm(21,"hr"),t.DNE(22,$,65,21,"div",0),t.j41(23,"div",1),t.DNE(24,W,2,1,"div",2),t.k0s()),2&a&&(t.R7$(1),t.SpI("Student Activity Logs For ",s.course.courseName,""),t.R7$(7),t.SpI("",s.LOGS_RETENTION_PERIOD," days"),t.R7$(5),t.JRh(s.lastUpdated),t.R7$(6),t.SpI("",s.STUDENT_ACTIVITY_LOGS_UPDATE_INTERVAL," minute"),t.R7$(3),t.Y8G("tmIsLoading",s.isLoading),t.R7$(2),t.Y8G("tmIsLoading",s.isSearching))},dependencies:[e.YU,e.Sq,e.bT,g.cw,h.xH,h.y7,h.me,h.wz,h.BC,h.vS,G.n,x.F,L.c,B.n,e.lG],styles:[".bg-form[_ngcontent-%COMP%]{background-color:#eaeff5}.no-border[_ngcontent-%COMP%]{border:0}.alert-success-border[_ngcontent-%COMP%]{border-color:#c3e6cb}.no-activity-body[_ngcontent-%COMP%]{padding:.5rem 1rem}.form-control[readonly][_ngcontent-%COMP%]{background-color:#fff}"]})}return d})();var J=r(84309),z=r(57125),Z=r(36853),Q=r(90637);const q=[{path:"",component:H}];let tt=(()=>{class d{static#t=this.\u0275fac=function(a){return new(a||d)};static#e=this.\u0275mod=t.$C({type:d});static#o=this.\u0275inj=t.G2t({imports:[e.MD,C.iI.forChild(q),g.IQ,h.YN,g.zH,J.y,z.o,Z.H,Q.g]})}return d})()},28735:(R,I,r)=>{r.d(I,{K:()=>g});var e=r(8059),h=r(17705),C=r(16507);let g=(()=>{class T{constructor(n){this.httpRequestService=n}createFeedbackSessionLog(n){const c={courseid:n.courseId,fsname:n.feedbackSessionName,studentemail:n.studentEmail,fsltype:n.logType.toString()};return n.feedbackSessionId&&(c.fsid=n.feedbackSessionId),n.studentId&&(c.studentid=n.studentId),this.httpRequestService.post(e.Ld.SESSION_LOGS,c)}searchFeedbackSessionLog(n){const c={courseid:n.courseId,fslstarttime:n.searchFrom,fslendtime:n.searchUntil};return n.studentEmail&&(c.studentemail=n.studentEmail),n.sessionName&&(c.fsname=n.sessionName),n.logType&&(c.fsltype=n.logType),n.studentId&&(c.studentid=n.studentId),n.sessionId&&(c.fsid=n.sessionId),this.httpRequestService.get(e.Ld.SESSION_LOGS,c)}searchLogs(n){const c={starttime:`${n.startTime||-1}`,endtime:`${n.endTime||-1}`};return n.order&&(c.order=n.order),n.severity&&(c.severity=n.severity),n.minSeverity&&(c.minseverity=n.minSeverity),n.logEvent&&(c.logevent=n.logEvent),n.actionClass&&(c.actionclass=n.actionClass),n.traceId&&(c.traceid=n.traceId),n.userInfoParams&&(n.userInfoParams.googleId&&(c.googleid=n.userInfoParams.googleId),n.userInfoParams.regkey&&(c.key=n.userInfoParams.regkey),n.userInfoParams.email&&(c.email=n.userInfoParams.email)),n.sourceLocation&&(n.sourceLocation.file&&(c.sourcelocationfile=n.sourceLocation.file),n.sourceLocation.function&&(c.sourcelocationfunction=n.sourceLocation.function)),n.exceptionClass&&(c.exceptionclass=n.exceptionClass),n.latency&&(c.latency=n.latency),n.status&&(c.status=n.status),n.version&&(c.version=n.version),n.extraFilters&&(c.extrafilters=n.extraFilters),this.httpRequestService.get(e.Ld.LOGS,c)}getActionClassList(){return this.httpRequestService.get(e.Ld.ACTION_CLASS)}static#t=this.\u0275fac=function(c){return new(c||T)(h.KVO(C.R))};static#e=this.\u0275prov=h.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()}}]);